@{
    @section Title
{
        Case Notes Client

    }



    if (Session["Roleid"] != null && (Session["Roleid"].ToString().Contains("a65bb7c2-e320-42a2-aed4-409a321c08a5") || Session["Roleid"].ToString().Contains("3b49b025-68eb-4059-8931-68a0577e5fa2")))
    {
        Layout = "~/Views/Shared/AgencyAdminLayout.cshtml";
    }
    else
    {

     Layout = "~/Views/Shared/AgencyStaffLayout.cshtml";
    }

}

@using FingerprintsModel;
@section Script{

    <script type="text/javascript">
        var count = 1;
        //var tags_array = ["lorem, ipsum, dolar, sit, amet"];
        function ShowSecurityAlert() {
            BootstrapDialog.show({
                title: 'Secure Case Note Alert',
                message: "Can't view the secured Case Note",
                buttons: [{
                    label: 'OK',
                    action: function (dialog) {
                        dialog.close();
                    }

                }]
            });

        }

        $(document).ready(function () {



            $(document).on("change", '[name="maincase"]', function () {

                var _val = $(this).prop("checked");

                if (_val) {
                    //$(".subcasecheck").
                    $(".subcasecheck").prop("checked", true);
                    $(".subcasecheck").prop("disabled", true);

                } else {
                    $(".subcasecheck").prop("checked", false);
                    $(".subcasecheck").prop("disabled", false)
                }

            });

            $(document).on("click", "#deletecasenote_btn", function () {

                var _MainSlcted = $('[name="maincase"]').prop("checked"); 
                var _MainId = $('[name="maincase"]').val(), appendId = [];
                //if (_MainSlcted) {
                //    _MainId = $('[name="maincase"]:checked').val();
                //}

                $.each($(".subcasecheck:checked"), function (ind, ele) {
                    //console.log(ele.value);

                    appendId.push(ele.value);
                });

                if (!_MainSlcted && !appendId.length) {

                    customAlert("Please select case note or append case note");
                    return false;
                }

                $.ajax({
                    type:"POST",
                    datatype: "json",
                    contentType: 'application/json',
                    beforeSend: function () { $("#spinner").show() },
                    url: "@Url.Action("DeleteCaseNote", "Roster")",
                    data: JSON.stringify({ casenoteid: _MainId, appendcid: appendId, deletemain: _MainSlcted }),
                success:function(data){
                    if (data) {
                        customAlert("Case Note has been deleted successfully");
                        // $('tr[casenoteid="10743"]').hide()
                        setTimeout(function () {
                            //   window.location.reload();
                            window.location.href = window.location.href.replace("#", "")
                        }, 2000);

                    } else {
                        customAlert("Something went wrong");
                    }
                }, fail: function (res) {
                    customAlert("Something went wrong, try again");
                }, complete: function (res) {
                    $("#spinner").hide();
                    $("#DeleteCaseNote_Modal").modal("hide");
                }


                });

            });

            $(document).on("click", ".delete-casenote", function (e) {
                e.preventDefault();

                var _cid = $(this).data('id');
                var _noteLoaded = false, _subnoteLoaded = false, _mainNote = {}, _subNotes = [];

                $("#spinner").show();
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("Getcasenotedetails", "Roster")?CaseNoteId=" + _cid,
                    success: function (data) {
                        _noteLoaded = true;
                        _mainNote = data;//_mainNote = data[0];
                    },
                    fail: function (res) {

                    },
                    complete: function (res) {
                        if (_subnoteLoaded == true) {
                            //  $("#spinner").hide();
                            loadModalData(_mainNote, _subNotes);
                        }

                    }

                });


                $.ajax({
                    type: "POST",
                    url: "@Url.Action("GetSubNotes", "Roster")?CaseNoteId=" + _cid,
                    success: function (data) {
                        _subnoteLoaded = true; _subNotes = data;
                    },
                    fail: function (res) {

                    },
                    complete: function (res) {
                        if (_noteLoaded == true) {
                           // $("#spinner").hide();
                            loadModalData(_mainNote, _subNotes);
                           
                        }

                    }

                });




            });

            function loadModalData(mainNote,subNote)
            {
                $("#spinner").hide();
                $("#DeleteCaseNote_Modal").modal("show");
                var _mNt={};
                if (Array.isArray(mainNote) && mainNote.length > 0) {
                    _mNt = mainNote[0];
                } else {
                    _mNt = mainNote;
                }

                $("#mainnote-tbl tbody, #subnote-tbl tbody").html('');

               
                var str = '<tr><td><input type="checkbox" data-CaseNoteid="' + _mNt.CaseNoteid + '" name="maincase" value="' + _mNt.CaseNoteid + '" /></td>';
                str += '<td>' + _mNt.Date + '</td><td>' + $('<div>' + _mNt.Note + '</div>').text().slice(0, 70) + "..." + '</td></tr>';
               
                $("#mainnote-tbl tbody").html(str);

                var _subStr = "";

                if (Array.isArray(subNote) && subNote.length > 0) {

                    subNote.forEach(function (obj, ind) {

                        _subStr += '<tr><td><input class="subcasecheck" data-SubCasenoteid="' + obj.SubCasenoteid + '" type="checkbox" name="subcase_' + ind + '" value="' + obj.SubCasenoteid + '" /></td>';

          _subStr += '<td>' + moment(obj.WrittenDate).format('MM/DD/YYYY') + '</td><td>' + $('<div>' +obj.Notes + '</div>').text().slice(0, 70) + "..." + '</td></tr>';
                    });

                   
                } else {
                    _subStr+='<tr><td colspan="3">No append Notes</td></tr>';
                }
                $("#subnote-tbl tbody").html(_subStr);
               //<tr><td><input type="checkbox" name="maincase" /></td>
               //                     <td>11/05/2018</td><td>Test String</td></tr>

               //                     subnote-tbl

               // <tr>
               //                         <td><input type="checkbox" name="subcase[0]" /></td>
               //                         <td>11/07/2018</td>
               //                         <td>Test append1</td>
               //                     </tr>

                console.log(mainNote, subNote);
            };


            $('input').keypress(function () {
                if ($(this).val() == 'MM/DD/YYYY') {
                    $(this).val('');
                    // $(this).mask("99/99/9999", { placeholder: 'MM/DD/YYYY' });
                }
            });
            if ('@ViewBag.message' != '') {
                customAlert('@ViewBag.message');
            }
            $('#Rosterli').addClass("active");
            $('#Yakkrli').removeClass("active");
            $('#Appointmentli').removeClass("active");
            $('#CaseNoteDate').mask("99/99/9999", { placeholder: 'MM/DD/YYYY' });
            $('#CaseNotetags,#AppendCaseNotetags').tagsInput({
                width: 'auto',
                height: '38px',
                delimiter: [',', ';'],
                //autocomplete_url: '/Roster/GetCaseNoteTagonInput?searchText=' + $('#CaseNotetags').val(),

                autocomplete_url: '/Roster/GetCaseNoteTag',
                //autocomplete_url:function (request, response) {
                //    return getTagsOnInput();
                //}
                //autocomplete: {
                //    //'source': tags_array[0].split(/,\s*/)
                //    'source': getTagsOnInput()
                //},
                //allowDuplicates: false
            });


            //var tagInp = $('#CaseNotetags').val();
            //var tagsArr = [];
            //$.ajax({

            //    url: '/Roster/GetCaseNoteTagonInput',


            $('#txtSearch').tagsInput({
                width: 'auto',
                height: '39px',
                delimiter: ['', ''],
                autocomplete_url: '/Roster/GetCaseNoteTag',
                //autocomplete: {
                //    'source': getTagsOnInput()
                //},

            });

            $('#txtSearch_tag').attr({ 'placeholder': 'Search by Tags' });


            CKEDITOR.replace('Note', {
                language: 'en-gb',
                uiColor: '#295b8f',
                disableNativeSpellChecker: false
            });
            CKEDITOR.replace('subnotes', {
                language: 'en-gb',
                uiColor: '#295b8f',
                disableNativeSpellChecker: false
            });


            $(window).bind("load resize", function () {

                topOffset = 50;
                width = (this.window.innerWidth > 0) ? this.window.innerWidth : this.screen.width;
                if (width < 768) {
                    topOffset = 100; // 2-row-menu
                }

                height = ((this.window.innerHeight > 0) ? this.window.innerHeight : this.screen.height) - 1;

                height = height - topOffset;
                if (height < 1) height = 1;
                if (height > topOffset) {
                    var fileHeight = height - 25;

                    $('.right-side-container-ch').css('min-height', (fileHeight - 5) + 'px');
                    $('.scroll-tbody').height(fileHeight - 317);
                }

                //reSizeContent();
            });


            $('#clientSelect').on('change', function () {

                $.ajax({
                    url:'/Roster/GetCaseNoteByClient',
                    type:'POST',
                    beforeSend: function () { $('#spinner').show() },
                    data: { 'clientId': $(this).val(), 'householdId': $('#HouseHoldId').val() },
                    success: function (data) {
                        $('#spinner').hide();

                        bindCaseNoteTableSection(data);

                    },
                    error: function (data) {
                        $('#spinner').hide();
                    }



                });


            });


            $('.btn-search').click(function () {
                $.ajax({
                    type: "POST",
                    url: "/Roster/GetCaseNoteByTags",
                    beforeSend:function(){$('#spinner').show()},
                    data: { 'Householdid': $('#HouseHoldId').val(), 'centerid': $('#CenterId').val(), 'ClientId': $('#ClientId').val(), 'TagName': $('#txtSearch').val() },
                    success: function (data) {
                        $('#spinner').hide();
                        bindCaseNoteTableSection(data)
                    },
                    error: function (data) {
                        $('#spinner').hide();
                        console.log(data);
                    }
                });
            });


            $('.casenote-date').val(getFormattedDateNumber(new Date()));



        });


        function bindCaseNoteTableSection(data) {
            $('.addn-table-head').empty();
            $('.appendRole').val(data.Role);
            console.log(data);
            $((data.CaseNoteList)).each(function (i, val) {

                var row = '<tr casenoteid="{casenoteid}">\
                                                    <td data-title="Date">\
                                                        <div class="addn-content-desc" style="position: relative;">\
                                                            <p>{Date}</p>\
                                                        </div>\
                                                    </td>\
                                                    <td data-title="Title">\
                                                        <div  class="addn-content-desc" style="position: relative;cursor: pointer;">\
                                                            <p data-editable="' + val.IsEditable + '" style="text-decoration: underline;" onclick="{function}({Id})">{Title}</p>\
                                                        </div>\
                                                    </td>\
                                                    <td data-title="By">\
                                                        <div class="addn-content-desc" style="position: relative;">\
                                                            <p>{BY}</p>\
                                                        </div>\
                                                    </td>\
                                                    <td data-title="Attachments">\
                                                        <div class="addn-content-desc">\
                                                            <p>{Attachment}</p>\
                                                        </div>\
                                                    </td>\
                                                    <td data-title="References">\
                                                        <div class="addn-content-desc">\
                                                            <p>{References}</p>\
                                                        </div>\
                                                    </td>   \
                                                     <td data-title="Actions">\
                                                        <div class="addn-content-desc">{SUBNOTE}\
                                                            </div>\
                                                        </td>\</tr>';
                var subnote = '<p style="padding: 5px;">\
                                                                <span class="Status-title-addn note-click">\<a href="#" data-toggle="modal" class="add-new" onclick="AppendCaseNote({AppendCaseNoteID})" style="margin-top: 0;padding-left: 15px;">\
                                                                        <span style="width: auto;display: inline-block;margin-right: 2px;font-size: 20px;">+</span>\
                                                                        Append Case Note\
                                                                    </a> </span>\
                                                            </p>';

            
                row = row.replace('{casenoteid}', val.CaseNoteid);
                row = row.replace('{AppendCaseNoteID}', val.CaseNoteid);
                row = row.replace('{Date}', val.Date);
                row = row.replace('{Id}', val.CaseNoteid);
                if (val.IsAllowSecurityCN == true) {
                    row = row.replace('{Title}', val.Title);
                    row = row.replace('{function}', "Getcasenote");
                    row = row.replace('{SUBNOTE}', subnote);
                }
                else if (val.WrittenBy == $('#UserId').val() && val.SecurityLevel) {
                    row = row.replace('{Title}', val.Title);
                    row = row.replace('{function}', "Getcasenote");
                    row = row.replace('{SUBNOTE}', subnote);
                }
                else {
                    row = row.replace('{Title}', "Secured Case Note");
                    row = row.replace('{function}', "ShowSecurityAlert");
                    row = row.replace('{SUBNOTE}', "<p style='padding: 5px;height:50px;'>");
                }

                row = row.replace('{BY}', val.BY);
                row = row.replace('{Attachment}', val.Attachment);
                row = row.replace('{References}', val.References);
                $('.addn-table-head').append(row);
            });
        }
        

        function getTagsOnInput() {
    
            //  var tagInp = $('#CaseNotetags').val();
            var tagInp = $('#CaseNotetags_tag').val();
            
            var tagsArr = [];
            $.ajax({

                url: '/Roster/GetCaseNoteTagonInput',
                datatype:'json',
                type: 'post',
                async:true,
                data: { searchText: tagInp },
                success: function (data) {
                    if (data != null) {
                        if (data.length > 0) {
                            $.each(data, function (i, tags) {
                                tagsArr.push(tags.Text);
                            });
                        }
                    }
                },
                error: function (data) {

                }

            });

            return tagsArr;
        }


        function Getcasenote(Casenoteid,clientId,ele) {

            var isEditable = $(ele).data("editable");
            $('#CaseNoteid').val(Casenoteid);
            $.ajax({
                url: HostedDir + "/Roster/Getcasenotedetails",
                type: "POST",
                data: {
                    Casenoteid: Casenoteid,
                    ClientId: clientId
                },
                dataType: "json",
               //secureuri: false,
                //  async: false,
                beforeSend:function(){$('#spinner').show()},
                success: function (Data) {
                    debugger;
                    $('#spinner').hide();
                    
                    BindCaseNotelist(Data,isEditable);
                    GetSubNotes(Casenoteid);
                  // GetSubNotes(Casenoteid);

                }
            , error: function (Data) {
                $('#spinner').hide();
                customAlert("Error occured please try again later.");
            }
            });
        }
        function GetSubNotes(id) {
            debugger;
            $.ajax({
                type: "POST",
                url: "/Roster/GetSubNotes",
                async: false,
                data: { 'CaseNoteId': id },

                success: function (data) {
                    //alert(data);
                    $('.sub-notes-details').empty();
                    console.clear();
                    console.log(data);
                    debugger;
                    if (data != null && data.length > 0) {
                        $(data).each(function (i, val) {
                            debugger
                            var attachments = '';
                            var tagsName = '';
                            for (var i = 0; i < val.Attachment.length; i++) {
                                if (val.Attachment[i] != "0" && val.Attachment[i] != "")
                                    attachments += ("<a  title='Click here to download' href='" + HostedDir + "/Agencyuser/getpdfimage1/" + val.Attachment[i] + ",CaseNote,0'><i class='fa fa-download'></i></a>&nbsp;&nbsp;&nbsp;&nbsp;");

                            }
                            for (var i = 0; i < val.Tags.length; i++) {
                                if (val.Tags[i] != "0" && val.Tags[i] != "")
                                    tagsName += ('<span id="subTags" class="tag-text">' + val.Tags[i] + '</span>');

                            }
                            if (tagsName == "") {
                                tagsName = "<span>No tags available</span>";
                            }
                            var template = '   <div class="addn-poup-div sub-text-block">\
                                             <h4>\
                                                 Posted on <span>{date},</span> by <span>{name}</span>\
                                             </h4>\
                                  <div class="col-xs-12 tag-text-block">\
                                      <label>Tags:</label>\
                                       {SubTags}\
                                </div><div class="col-xs-12 tag-text-block">\
                                 <label>Notes:</label>\
                                    {notes}\
                                      <div id="subAttachments" class="sub-text">\
                                 <label>Attachments:</label>{SubAttach}</div>\
                                </div></div>';

                            template = template.replace('{date}', val.WrittenDate);
                            template = template.replace('{name}', val.Name);
                            template = template.replace('{notes}', val.Notes);
                            template = template.replace('{SubAttach}', attachments);
                            template = template.replace('{SubTags}', tagsName);
                            $('.sub-notes-details').append(template);
                        });
                    }
                    else {
                        var template = '   <div class="addn-poup-div">\
                                             <h4>\
                                                 No record found\
                                             </h4>\
                                             \
                                         </div>';
                        $('.sub-notes-details').append(template);
                    }




                },
                error: function (data) {
                    console.log(data);
                }
            });
        }
        function Getcasenote1(Casenoteid) {
            $('#CaseNoteid').val(Casenoteid);
            $.ajax({
                url: HostedDir + "/Roster/Getcasenotedetails",
                type: "POST",
                data: {
                    Casenoteid: Casenoteid,
                    ClientId: $('#ClientId').val()
                },
                dataType: "json",
                secureuri: false,
                async: false,
                success: function (Data) {
                    console.log(Data);
                    BindCaseNotelist1(Data);
                }
            , error: function (Data) {
                customAlert("Error occured please try again later.");
            }
            });
        }
        function getFormattedDate(Dates) {
            var monthNames = ["January", "February", "March", "April", "May", "June",
"July", "August", "September", "October", "November", "December"
            ];
            var date = new Date(Dates);
            var year = date.getFullYear();

            var month = (1 + date.getMonth()).toString();
            month = month.length > 1 ? month : '0' + month;
            console.log('month:' + month);
            var day = date.getDate().toString();
            day = day.length > 1 ? day : '0' + day;

            return monthNames[parseInt(month)] + ' ' + day + ',' + year;
        }
        function getFormattedDateNumber(date) {
            date = new Date(date);
            var year = date.getFullYear();

            var month = (1 + date.getMonth()).toString();
            month = month.length > 1 ? month : '0' + month;

            var day = date.getDate().toString();
            day = day.length > 1 ? day : '0' + day;

            return month + '/' + day + '/' + year;
        }




        function BindCaseNotelist(Data,iseditable) {
           
            cleanValidation();
            //$('#Attachment').hide();
            $('#Attachments').show();
            $('#Attach').empty();
            $('.download-attachment').empty();
            //$('#SaveNoteSubmit').hide();
            console.log('Test');
            console.log(Data);
            $('.tag').remove();
            var outputArray = [];
            var Attachments = [];
            if (Data != null && Data.length > 0) {

                if (Data[0].GroupCaseNote == 0) {

                    $('#CaseNoteHeading').text('Edit Case Note');
                    $('#Attachmectstag').removeAttr("onclick");
                    $('#Attachmectstag').attr("onclick", "AddMore();");
                    $('#FirstFile').removeAttr("disabled");
                    $('#SaveNoteSubmit').show();
                    $('#CaseNoteDate').val('');
                    $('#CaseNotetitle').val('');
                    $('#CaseNotesNote').val('');
                    $('#ClientName').val('');
                    $('#ClientNameModel').val('');
                    $('#CaseNoteSecurity').prop("checked", false);
                    $('#CaseNoteSecurity').removeAttr("disabled");
                    $('#ClientDiv input[type=checkbox]').each(function () {
                        $(this).prop("checked", false);
                        $(this).removeAttr("disabled");
                    });
                    $('#StaffDiv input[type=checkbox]').each(function () {
                        $(this).prop("checked", false);
                        $(this).removeAttr("disabled");
                    });

                    $('#CaseNoteDate').val(Data[0].Date);

                    $('#CaseNotetitle').val(Data[0].Title);
                    CKEDITOR.instances['Note'].setData(Data[0].Note);
                    $('.main-date').text(getFormattedDate(Data[0].Date));
                    $('.main-note').empty();
                    $('.main-note').append(Data[0].Note);
                    $('#ClientName').text(Data[0].Name);
                    $('#ClientNameModel').text(Data[0].Name);

                    if (Data[0].SecurityLevel) {
                        $('#CaseNoteSecurity').prop("checked", true);

                    }
                      
                    for (var i = 0; i < Data.length; i++) {
                        $('#ClientDiv input[type=checkbox]').each(function () {
                            if ($(this).val() == Data[i].clientid)
                                $(this).prop("checked", true);
                        });
                    }
                   
                    
                    
                    for (var i = 0; i < Data.length; i++) {
                        if ((jQuery.inArray(Data[i].Tagname, outputArray)) == -1) {
                            outputArray.push(Data[i].Tagname);
                        }
                    }
                    for (var i = 0; i < Data.length; i++) {
                        if ((jQuery.inArray(Data[i].Attachment, Attachments)) == -1) {
                            Attachments.push(Data[i].Attachment);
                        }
                    }


                    for (var i = 0; i < Attachments.length; i++) {
                        if (Attachments[i] != "0" && Attachments[i] != "")
                            $('#Attach').add('.download-attachment').append("<a  title='Click here to download' href='" + HostedDir + "/Agencyuser/getpdfimage1/" + Attachments[i] + ",CaseNote,0'><i class='fa fa-download'></i></a>&nbsp;&nbsp;&nbsp;&nbsp;");

                    }
                    if ($('#Attach').children().length < 1) {
                        $('#Attach').append("<span>No file available</span>");
                    }
                    if ($('.download-attachment').children().length < 1) {
                        $('.download-attachment').append("<span>No file available</span>");
                    }
                    for (var i = 0; i < outputArray.length; i++) {
                        $('#CaseNotetags_tagsinput').prepend('<span class="tag"><span>' + outputArray[i] + '&nbsp;&nbsp;</span><a href="#" onclick="removetag1(this);" title="Removing tag">x</a></span>');
                    }
                    for (var i = 0; i < Data.length; i++) {
                        $('#StaffDiv input[type=checkbox]').each(function () {
                            if ($(this).val() == Data[i].Staffid)
                                $(this).prop("checked", true);
                        });
                    }
                    $('#StaffName').text(Data[0].BY);
                    $('#CaseNoteDate').attr("Readonly", true);
                    $('#CaseNotetitle').attr("Readonly", true);
                    //$('#CaseNoteSecurity').attr("disabled",true);
                    CKEDITOR.instances['Note'].setReadOnly(true);
                    //$('#ClientDiv input[type=checkbox]').each(function () {
                    //    $(this).attr("disabled",true);
                    //});
                    //$('#StaffDiv input[type=checkbox]').each(function () {
                    //    $(this).attr("disabled",true);
                    //});
                    $('#CaseNotetags_tag').removeAttr("disabled");
                }
                else if (Data[0].GroupCaseNote == 1) {
                    $('#CaseNoteHeading').text('Group Case Note');
                    $('#Attachmectstag').removeAttr("onclick");
                    $('#Attachmectstag').attr("onclick", "return false;");
                    $('#SaveNoteSubmit').hide();
                    $('#CaseNoteDate').val('');
                    $('#CaseNotetitle').val('');
                    $('#CaseNotesNote').val('');
                    $('#ClientName').val('');
                    $('#ClientNameModel').val('');
                    $('#CaseNoteSecurity').prop("checked", false);
                    $('#CaseNoteSecurity').attr("disabled", "disabled");
                    $('#CaseNotetags_tag').attr("disabled", "disabled");
                    $('#FirstFile').attr("disabled", "disabled");

                    $('#ClientDiv input[type=checkbox]').each(function () {
                        $(this).prop("checked", false);
                        $(this).attr("disabled", "disabled");
                    });
                    $('#StaffDiv input[type=checkbox]').each(function () {
                        $(this).prop("checked", false);
                        $(this).attr("disabled", "disabled");
                    });
                    $('.main-date').text(getFormattedDate(Data[0].Date));
                    $('.main-note').empty();
                    $('.main-note').append(Data[0].Note);
                    $('#CaseNoteDate').val(Data[0].Date);
                    $('#CaseNotetitle').val(Data[0].Title);
                    CKEDITOR.instances['Note'].setData(Data[0].Note);
                    $('#ClientName').text(Data[0].Name);
                    $('#ClientNameModel').text(Data[0].Name);
                    if (Data[0].SecurityLevel)
                        $('#CaseNoteSecurity').prop("checked", true);
                    for (var i = 0; i < Data.length; i++) {
                        $('#ClientDiv input[type=checkbox]').each(function () {
                            if ($(this).val() == Data[i].clientid) {
                                $(this).prop("checked", true);
                            }
                        });
                    }
                    for (var i = 0; i < Data.length; i++) {
                        if ((jQuery.inArray(Data[i].Tagname, outputArray)) == -1) {
                            outputArray.push(Data[i].Tagname);
                        }
                    }
                    for (var i = 0; i < Data.length; i++) {
                        if ((jQuery.inArray(Data[i].Attachment, Attachments)) == -1) {
                            Attachments.push(Data[i].Attachment);
                        }
                    }
                    for (var i = 0; i < Attachments.length; i++) {
                        if (Attachments[i] != "0" && Attachments[i] != "")
                            $('#Attach').add('.download-attachment').append("<a  title='Click here to download' href='" + HostedDir + "/Agencyuser/getpdfimage1/" + Attachments[i] + ",CaseNote,0'><i class='fa fa-download'></i></a>&nbsp;&nbsp;&nbsp;&nbsp;");

                    }
                    if ($('#Attach').children().length < 1) {
                        $('#Attach').append("<span>No file available</span>");
                    }
                    if ($('.download-attachment').children().length < 1) {
                        $('.download-attachment').append("<span>No file available</span>");
                    }
                    for (var i = 0; i < outputArray.length; i++) {
                        $('#CaseNotetags_tagsinput').prepend('<span class="tag"><span>' + outputArray[i] + '&nbsp;&nbsp;</span><a href="#"  title="Removing tag">x</a></span>');
                    }
                    for (var i = 0; i < Data.length; i++) {
                        $('#StaffDiv input[type=checkbox]').each(function () {
                            if ($(this).val() == Data[i].Staffid)
                                $(this).prop("checked", true);
                        });
                    }
                    $('#StaffName').text(Data[0].BY);
                    $('#CaseNoteDate').attr("Readonly", true);
                    $('#CaseNotetitle').attr("Readonly", true);
                    //$('#CaseNoteSecurity').attr("disabled",true);
                    CKEDITOR.instances['Note'].setReadOnly(true);
                    //$('#ClientDiv input[type=checkbox]').each(function () {
                    //    $(this).attr("disabled",true);
                    //});
                    //$('#StaffDiv input[type=checkbox]').each(function () {
                    //    $(this).attr("disabled",true);
                    //});





                }



                if (!$('#ModalAddCasenote').hasClass('in'))
                    $('#ModalAddCasenote').modal('toggle');
                $('#ModalAddCasenote').modal({
                    backdrop: 'static',
                    keyboard: false,
                    show: true,

                });

                if (!iseditable) {
                    //$("#ClientDiv").find('[type="checkbox"]').prop('disabled', true);
                    // $("#StaffDiv").find('[type="checkbox"]').prop('disabled', true);
                    $('[name="ClientIds.IDS"][type="checkbox"]').prop('disabled', true);
                    $('[name="TeamIds.IDS"][type="checkbox"]').prop('disabled', true);
                    $(".addn-poup-div1").find('[type="checkbox"]').prop('disabled', true);
                    $('#FirstFile[type="file"]').prop("disabled", true);
                    $(".add-attach-btn, #SaveNoteSubmit").css("display", "none");
                    $("#CaseNotetags_tag").prop("disabled", true);

                } else {
                    $('#FirstFile[type="file"]').prop("disabled", false);
                    $(".add-attach-btn, #SaveNoteSubmit").css("display", "inline-block");
                }

            }
        }
        function BindCaseNotelist1(Data) {
            cleanValidation();
            //$('#Attachment').hide();
            $('#Attachments').show();
            $('#Attach').empty();
            $('.download-attachment').empty();
            //$('#SaveNoteSubmit').hide();
            console.log('Test');
            console.log(Data);
            $('.tag').remove();
            var outputArray = [];
            var Attachments = [];
          
            if (Data != null && Data.length > 0) {

                if (Data[0].GroupCaseNote == 0) {

                    $('#CaseNoteHeading').text('Edit Case Note');
                    $('#Attachmectstag').removeAttr("onclick");
                    $('#Attachmectstag').attr("onclick", "AddMore();");
                    $('#FirstFile').removeAttr("disabled");
                    $('#SaveNoteSubmit').show();
                    $('#CaseNoteDate').val('');
                    $('#CaseNotetitle').val('');
                    $('#CaseNotesNote').val('');
                    $('#ClientName').val('');
                    $('#ClientNameModel').val('');
                    $('#CaseNoteSecurity').prop("checked", false);
                    $('#CaseNoteSecurity').removeAttr("disabled");
                    $('#ClientDiv input[type=checkbox]').each(function () {
                        $(this).prop("checked", false);
                        $(this).removeAttr("disabled");
                    });
                    $('#StaffDiv input[type=checkbox]').each(function () {
                        $(this).prop("checked", false);
                        $(this).removeAttr("disabled");
                    });

                    $('#CaseNoteDate').val(Data[0].Date);

                    $('#CaseNotetitle').val(Data[0].Title);
                    CKEDITOR.instances['Note'].setData(Data[0].Note);
                    $('.main-date').text(getFormattedDate(Data[0].Date));
                    $('.main-note').empty();
                    $('.main-note').append(Data[0].Note);
                    $('#ClientName').text(Data[0].Name);
                    $('#ClientNameModel').text(Data[0].Name);

                    if (Data[0].SecurityLevel)
                        $('#CaseNoteSecurity').prop("checked", true);
                    for (var i = 0; i < Data.length; i++) {
                        $('#ClientDiv input[type=checkbox]').each(function () {
                            if ($(this).val() == Data[i].clientid)
                                $(this).prop("checked", true);
                        });
                    }

                    for (var i = 0; i < Data.length; i++) {
                        if ((jQuery.inArray(Data[i].Tagname, outputArray)) == -1) {
                            outputArray.push(Data[i].Tagname);
                        }
                    }
                    for (var i = 0; i < Data.length; i++) {
                        if ((jQuery.inArray(Data[i].Attachment, Attachments)) == -1) {
                            Attachments.push(Data[i].Attachment);
                        }
                    }


                    for (var i = 0; i < Attachments.length; i++) {
                        if (Attachments[i] != "0" && Attachments[i] != "")
                            $('#Attach').add('.download-attachment').append("<a title='Click here to download' href='" + HostedDir + "/Agencyuser/getpdfimage1/" + Attachments[i] + ",CaseNote,0'><i class='fa fa-download'></i></a>&nbsp;&nbsp;&nbsp;&nbsp;");

                    }
                    if ($('#Attach').children().length < 1) {
                        $('#Attach').append("<span>No file available</span>");
                    }
                    if ($('.download-attachment').children().length < 1) {
                        $('.download-attachment').append("<span>No file available</span>");
                    }
                    for (var i = 0; i < outputArray.length; i++) {
                        $('#CaseNotetags_tagsinput').prepend('<span class="tag"><span>' + outputArray[i] + '&nbsp;&nbsp;</span><a href="#" onclick="removetag(this);" title="Removing tag">x</a></span>');
                    }
                    for (var i = 0; i < Data.length; i++) {
                        $('#StaffDiv input[type=checkbox]').each(function () {
                            if ($(this).val() == Data[i].Staffid)
                                $(this).prop("checked", true);
                        });
                    }
                    $('#StaffName').text(Data[0].BY);
                    $('#CaseNoteDate').attr("Readonly", true);
                    $('#CaseNotetitle').attr("Readonly", true);
                    //$('#CaseNoteSecurity').attr("disabled",true);
                    CKEDITOR.instances['Note'].setReadOnly(true);
                    //$('#ClientDiv input[type=checkbox]').each(function () {
                    //    $(this).attr("disabled",true);
                    //});
                    //$('#StaffDiv input[type=checkbox]').each(function () {
                    //    $(this).attr("disabled",true);
                    //});
                    $('#CaseNotetags_tag').removeAttr("disabled");
                }
                else if (Data[0].GroupCaseNote == 1) {
                    $('#CaseNoteHeading').text('Group Case Note');
                    $('#Attachmectstag').removeAttr("onclick");
                    $('#Attachmectstag').attr("onclick", "return false;");
                    $('#SaveNoteSubmit').hide();
                    $('#CaseNoteDate').val('');
                    $('#CaseNotetitle').val('');
                    $('#CaseNotesNote').val('');
                    $('#ClientName').val('');
                    $('#ClientNameModel').val('');
                    $('#CaseNoteSecurity').prop("checked", false);
                    $('#CaseNoteSecurity').attr("disabled", "disabled");
                    $('#CaseNotetags_tag').attr("disabled", "disabled");
                    $('#FirstFile').attr("disabled", "disabled");

                    $('#ClientDiv input[type=checkbox]').each(function () {
                        $(this).prop("checked", false);
                        $(this).attr("disabled", "disabled");
                    });
                    $('#StaffDiv input[type=checkbox]').each(function () {
                        $(this).prop("checked", false);
                        $(this).attr("disabled", "disabled");
                    });
                    $('.main-date').text(getFormattedDate(Data[0].Date));
                    $('.main-note').empty();
                    $('.main-note').append(Data[0].Note);
                    $('#CaseNoteDate').val(Data[0].Date);
                    $('#CaseNotetitle').val(Data[0].Title);
                    CKEDITOR.instances['Note'].setData(Data[0].Note);
                    $('#ClientName').text(Data[0].Name);
                    $('#ClientNameModel').text(Data[0].Name);
                    if (Data[0].SecurityLevel)
                        $('#CaseNoteSecurity').prop("checked", true);
                    for (var i = 0; i < Data.length; i++) {
                        $('#ClientDiv input[type=checkbox]').each(function () {
                            if ($(this).val() == Data[i].clientid) {
                                $(this).prop("checked", true);
                            }
                        });
                    }
                    for (var i = 0; i < Data.length; i++) {
                        if ((jQuery.inArray(Data[i].Tagname, outputArray)) == -1) {
                            outputArray.push(Data[i].Tagname);
                        }
                    }
                    for (var i = 0; i < Data.length; i++) {
                        if ((jQuery.inArray(Data[i].Attachment, Attachments)) == -1) {
                            Attachments.push(Data[i].Attachment);
                        }
                    }
                    for (var i = 0; i < Attachments.length; i++) {
                        if (Attachments[i] != "0" && Attachments[i] != "")
                            $('#Attach').add('.download-attachment').append("<a  title='Click here to download' href='" + HostedDir + "/Agencyuser/getpdfimage1/" + Attachments[i] + ",CaseNote,0'><i class='fa fa-download'></i></a>&nbsp;&nbsp;&nbsp;&nbsp;");

                    }
                    if ($('#Attach').children().length < 1) {
                        $('#Attach').append("<span>No file available</span>");
                    }
                    if ($('.download-attachment').children().length < 1) {
                        $('.download-attachment').append("<span>No file available</span>");
                    }
                    for (var i = 0; i < outputArray.length; i++) {
                        $('#CaseNotetags_tagsinput').prepend('<span class="tag"><span>' + outputArray[i] + '&nbsp;&nbsp;</span><a href="#"  title="Removing tag">x</a></span>');
                    }
                    for (var i = 0; i < Data.length; i++) {
                        $('#StaffDiv input[type=checkbox]').each(function () {
                            if ($(this).val() == Data[i].Staffid)
                                $(this).prop("checked", true);
                        });
                    }
                    $('#StaffName').text(Data[0].BY);
                    $('#CaseNoteDate').attr("Readonly", true);
                    $('#CaseNotetitle').attr("Readonly", true);
                    //$('#CaseNoteSecurity').attr("disabled",true);
                    CKEDITOR.instances['Note'].setReadOnly(true);
                    //$('#ClientDiv input[type=checkbox]').each(function () {
                    //    $(this).attr("disabled",true);
                    //});
                    //$('#StaffDiv input[type=checkbox]').each(function () {
                    //    $(this).attr("disabled",true);
                    //});





                }



                //if (!$('#ModalAddCasenote').hasClass('in'))
                //    $('#ModalAddCasenote').modal('toggle');
                //$('#ModalAddCasenote').modal('show');
            }
        }

        function removetag(object) {
            $(object).parent('.tag').remove();

        }

        function AddNewCaseNote(clientid) {
            $('.divAppendedNotes').hide();
            $('.sub-notes-details').empty();
            $('#CaseNoteHeading').text('Add New Case Note');
            $('#Attachmectstag').removeAttr("onclick");
            $('#Attachmectstag').attr("onclick", "AddMore();");
            $('#CaseNoteid').val(0);
            $('#Attachments').hide();
            $('#CaseNoteDate').val('');
            $('#CaseNotetitle').val('');
            $('#CaseNotesNote').val('');
            $('#ClientName').val('');
            $('#ClientNameModel').val('');
            $('#CaseNoteSecurity').prop("checked", false);
            $('#CaseNoteSecurity').removeAttr("disabled");
            $('#CaseNotetags_tag').removeAttr("disabled");

            $('#CaseNotetags_tag').removeAttr("FirstFile");
            $('.tag').remove();
            $('#ClientDiv input[type=checkbox]').each(function () {
                $(this).prop("checked", false);
                $(this).removeAttr("disabled");

            });
            $('#StaffDiv input[type=checkbox]').each(function () {
                $(this).prop("checked", false);
                $(this).removeAttr("disabled");
            });
            CKEDITOR.instances['Note'].setData("");
            $('#SaveNoteSubmit').show();
            $('#Attachment').show();
            $('#CaseNoteDate').attr("Readonly", false);
            $('#CaseNotetitle').attr("Readonly", false);
            $('#CaseNoteSecurity').attr("disabled", false);
            CKEDITOR.instances['Note'].setReadOnly(false);
            $('#ClientDiv input[type=checkbox]').each(function () {
                $(this).attr("disabled", false);

            });
            $('#StaffDiv input[type=checkbox]').each(function () {
                $(this).attr("disabled", false);
            });


            //if (!$('#ModalAddCasenote').hasClass('in'))
            //    $('#ModalAddCasenote').modal('toggle');
            $('#ModalAddCasenote').modal({
                backdrop: 'static',
                keyboard: false,
                show: true,

            });
        }
        var _validFileExtensions1 = [".pdf", ".jpg", ".jpeg", ".bmp", ".gif", ".png"];
        function ValidateSingleInputpdf2(oInput) {
            if (oInput.type == "file") {
                var sFileName = oInput.value;
                if (sFileName.length > 0) {
                    var blnValid = false;
                    var valid_size = 3 * 1000 * 1000;
                    var v = oInput.files[0].size;
                    if (v <= valid_size) {
                        for (var j = 0; j < _validFileExtensions1.length; j++) {
                            var sCurExtension = _validFileExtensions1[j];
                            if (sFileName.substr(sFileName.length - sCurExtension.length, sCurExtension.length).toLowerCase() == sCurExtension.toLowerCase()) {
                                $('#DobverificationinPaper').prop("checked", false);
                                blnValid = true;
                                break;
                            }
                        }
                        if (!blnValid) {
                            oInput.value = "";
                            return false;
                        }
                    }
                    else {
                        oInput.value = "";
                        customAlertforlongtime("File size should not be greater than 3 MB. ");
                        return false;

                    }

                }
            }
            return true;
        }
        function Checkdate(value) {
            isValid = true;
            if (!$(value).attr("readonly")) {

                if ($(value).val().trim() != "MM/DD/YYYY" && $(value).val().trim() != "") {
                    var dateformat = /^(0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])[\/\-]\d{4}$/;
                    var regex = new RegExp(dateformat);
                    if (!regex.test($(value).val())) {
                        customAlert("Invalid date format. ");
                        $(value).val('');
                        return false;
                    }
                    else {
                        var text = $(value).val();
                        var comp = text.split('/');
                        var m = parseInt(comp[0], 10);
                        var d = parseInt(comp[1], 10);
                        var y = parseInt(comp[2], 10);
                        var date = new Date(y, m - 1, d);
                        if (date.getFullYear() == y && date.getMonth() + 1 == m && date.getDate() == d) {

                        } else {
                            customAlert("Invalid date. ");
                            $(value).val('');
                            return false;
                        }



                    }
                }
                var txtdate = $(value).val();
                var selectedTimestampequal = new Date();
                var year = selectedTimestampequal.getFullYear();
                var month = selectedTimestampequal.getMonth() + 1;
                var day = selectedTimestampequal.getDate();
                today1 = month + '/' + day + '/' + year;
                var newinput = today1.split("/");
                var newday = newinput[1];
                var str = newday.substr(0, 1);
                var newdaynew = ('0' + newday).slice(-2);
                var newmonth = newinput[0];
                var str1 = newmonth.substr(0, 1);
                var newmonthnew = ('0' + newmonth).slice(-2);
                today = newmonthnew + '/' + newdaynew + '/' + year;
                if (today == txtdate) {
                    return true;
                }
                var testdatelocalinput = new Date(txtdate);
                var selectedTimestamp = new Date().getTime();
                var testdatelocalinputTS = testdatelocalinput.getTime();
                var timestamp = new Date().getTime() - (30 * 24 * 60 * 60 * 1000)
                if (testdatelocalinputTS > selectedTimestamp) {
                    customAlert("Case Note date must be less than or equal to today's date.");
                    $(value).val('');
                    return false;
                }
                else if (timestamp > testdatelocalinputTS) {
                    customAlert("Case Note date cannot be less than 30 days from today's date.");
                    $(value).val('');
                    return false;
                }
            }
            return true;
        }
        function AddMore() {
            $('#Attachment').append("<div class='col-sm-12 adddivspace' style='padding:0;'><div class='col-sm-4 col-xs-12' ><label></label>" +
                                     "</div><div class='col-sm-5 col-xs-12'> <input type='file'  name='Attachments[" + count + "].file' onchange='ValidateSingleInputpdf2(this)'  class='form-control' /></div>" +
                                     "<div class='col-sm-3 col-xs-12'><a href=\"javascript:void(0)\" title=\"Remove Attachment\" onclick=\"RemoveAttach(this,"+count+");\"><i class=\"fa fa-minus-circle\"> </i> Remove</a> </div> </div>");
            count++;
        }
        function RemoveAttach(_ele,count) {

            $(_ele).parents(".adddivspace").remove()


        }
        function Validatecasenote() {
            isValid = true;
            cleanValidation();
            var Clientcount = 0;
            var Tags = '';
            $('#CaseNotetags_tagsinput .tag span').each(function () {
                Tags = Tags + $(this).text().trim() + ',';
            });
            $("#CaseNotetags").val(Tags);

            $('#Note').val(CKEDITOR.instances['Note'].getData());

            $('#ClientDiv input:checked').each(function () {
                if ($(this).prop("checked")) {
                    Clientcount = 1;
                }
            });
            Tags = '';
            if ($('#CaseNoteDate').val().trim() == "") {
                isValid = false;
                customAlert("Case note date is required. ");
                plainValidation('#CaseNoteDate');
                return isValid;
            }
            else if ($('#CaseNotetitle').val().trim() == "") {
                isValid = false;
                customAlert("Title is required.");
                plainValidation('#CaseNotetitle');
                return isValid;
            }
            else if (CKEDITOR.instances['Note'].getData() == "") {
                isValid = false;
                customAlert("Note is required.");
                return isValid;
            }
            else if (Clientcount == 0) {
                isValid = false;
                customAlert("Clients name is required.");
                $('#ClientDiv').focus();
                return isValid;
            }
            else if ($('#CaseNotetags').val().trim() == "") {
                isValid = false;
                customAlert("Tags is required.");
                plainValidation('#CaseNotetags');
                return isValid;
            }
            else if ($('#CaseNotetags').val().trim() == "") {
                isValid = false;
                customAlert("Tags is required.");
                plainValidation('#CaseNotetags');
                return isValid;
            }
          
            return isValid;

        }

    </script>
}
@section MainContentHolder{



    <link href="~/Content/CaseNote/css/style.css" rel="stylesheet" />
    <style>


        .scroll-thead th {
            border: 1px solid #f1f5f8;
        }

        .scroll-thead {
            display: table;
            width: 100%;
            table-layout: fixed;
            width: 98.3%;
        }

        .scroll-tbody tr td, .scroll-tbody1 tr td {
            word-break: break-word;
        }

        .scroll-tbody {
            display: block;
            height: 250px;
            overflow: auto;
            overflow-x: hidden;
        }

            .scroll-tbody tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }




        #page-wrapper {
            padding-left: 0;
            padding-right: 0;
        }


        .backto_list{

        }

        .backto_list {
            padding: 9px 20px;
            background-color: #3498db;
            color: #fff;
            font-size: 14px;
            border-style: none;
            border-radius: 5px;
        }

        #txtSearch_tagsinput {
            width: 60% !important;
            min-height: 38px;
            height: 38px;
            display: inline-block !important;
            position: relative;
            top: 12px;
        }

        .download-attachment a i {
            font-size: 25px;
        }

        .download-attachment a {
            display: inline-block;
            width: auto !important;
            padding-top: 8px;
            padding-right: 10px;
        }

        .download-attachment span {
            padding-top: 18px;
            float: left;
        }
        .sub-text{float:left;width:100%;line-height:25px;}
        .addn-poup-div,.tag-text-block{float:left;width:100%;}

                .sub-text-block{padding:10px;background:#f9f9f9;margin-top:5px;}
                 .sub-text-block p{margin:0;padding:0;font-weight:bold;color: #34495e;}
                 .tag-text-block{padding:0;}
                 .tag-text-block label{width:auto;display:inline-block;float:left;    font-size: 16px;
            font-weight: normal;}
                 .tag-text{width:auto;display:inline-block;float:left;
            padding: 10px;
            text-decoration: none;
            background: #295b8f;
            color: #fff;
            margin-left: 5px;
            margin-bottom: 5px;
            font-family: helvetica;
            font-size: 13px;margin-top:7px;}
                 .sub-text-block{box-shadow:0 0 10px rgba(0,0,0,0.1);-webkit-box-shadow:0 0 10px rgba(0,0,0,0.1);}
                 .tag-text-block p, .tag-text-block i{width:auto;display:inline-block;float:left;margin-top:6px;margin-left:5px;}
            .tag-text-block i{margin-top:10px;}
            .page-header {
            margin: 8px 0px 20px !important;
        }
            
#DeleteCaseNote_Modal .modal-body {
    position: relative;
}
#DeleteCaseNote_Modal .modal-body {
    background: #34495e none repeat scroll 0 0;
    border: 6px solid #ffffff;
    border-radius: 3px;
    /* color: #ffffff; */
    float: left;
    padding: 15px 3%;
    position: relative;
    width: 100%;
}
#DeleteCaseNote_Modal .modal-body > h2 {
    margin-top: 10px;
    float: left;
    font-size: 24px;
    font-weight: 600;
    text-align: center;
    width: 100%;
    margin-bottom: 20px;
    color: #fff;
}
#DeleteCaseNote_Modal .close {
    opacity: 1;
    position: absolute;
    right: -14px;
    top: -15px;
}


    .glossy-button-button {
    display: inline-block;
    vertical-align: top;
    position: relative;
    overflow: hidden;
    min-width: 96px;
    line-height: 34px !important;
    padding: 0 24px;
    font-size: 14px;
    color: white;
    text-align: center;
    text-decoration: none;
    text-shadow: 0 1px #154c86;
    background-color: #247edd;
    background-clip: padding-box;
    border: 1px solid;
    border-color: #1c65b2 #18589c #18589c;
    border-radius: 4px;
    -webkit-box-shadow: inset 0 1px rgba(255, 255, 255, 0.4), 0 1px 2px rgba(0, 0, 0, 0.2);
    box-shadow: inset 0 1px rgba(255, 255, 255, 0.4), 0 1px 2px rgba(0, 0, 0, 0.2);
    background-image: -webkit-linear-gradient(top, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.12) 51%, rgba(0, 0, 0, 0.04));
    background-image: -moz-linear-gradient(top, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.12) 51%, rgba(0, 0, 0, 0.04));
    background-image: -o-linear-gradient(top, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.12) 51%, rgba(0, 0, 0, 0.04));
    background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.12) 51%, rgba(0, 0, 0, 0.04));
}
    .button-green {
    text-shadow: 0 1px #0d4d09;
    background-color: #1ca913;
    border-color: #147b0e #11640b #11640b;
}
    .button-red {
    text-shadow: 0 1px #0d4d09;
    background-color: #E21;
    border-color: #E21 #E21 #E21;
}

        #subnote-tbl thead tr,
        #mainnote-tbl thead tr {
         background:#9B58B4;
         color:#fff;
        }
        #subnote-tbl tbody tr,
        #mainnote-tbl tbody tr {
         text-align:center;
        }

        [name="maincase"],
        .subcasecheck
        {
            width: 20px;
            height: 20px;
        }

    </style>

    <div class="container-fluid">
        <div class="row">
            <div class="right-side-container-ch" style="padding-top: 30px;">

                <div class="col-xs-12" style="padding:0px 15px;margin-bottom:20px;">
                    <div class="col-lg-12">
                        <h2 class="page-header page-header-change" style="border-bottom:5px solid #f9c751!important;color:#fff;">
                            <i class="fa fa-briefcase" aria-hidden="true"></i>&nbsp;Case Note Manager

                            <span class="view-btn backto_listspan">

                                @if (ViewBag.Householdid != null && Convert.ToString(ViewBag.Householdid) != "0" && StaffDetails.GetInstance().RoleId.ToString().ToLowerInvariant()==EnumHelper.GetEnumDescription(RoleEnum.FamilyServiceWorker).ToLowerInvariant())
                                {
                                <a href="~/Agencyuser/FamilyDetails/@ViewBag.Householdid" style="padding:10px;float: right;color: #fff;margin-right:0px;background-color:#9b59b6;border-radius: 4px;text-decoration:none;" class="backto_list">Back to Family Intake</a>

                                }
                                else if (StaffDetails.GetInstance().RoleId.ToString().ToLowerInvariant() == EnumHelper.GetEnumDescription(RoleEnum.Teacher).ToLowerInvariant() || StaffDetails.GetInstance().RoleId.ToString().ToLowerInvariant() == EnumHelper.GetEnumDescription(RoleEnum.TeacherAssistant).ToLowerInvariant())
                                {
                                    <a href="@Url.Content("~/Teacher/Roster")" style="padding:10px;float: right;color: #fff;margin-right:0px;background-color:#9b59b6;border-radius: 4px;text-decoration:none;" class="backto_list">Back to Roster</a>

                                }
                                else
                                {

                                <a href="@Url.Content("~/Roster/Roster")" style="padding:10px;float: right;color: #fff;margin-right:0px;background-color:#9b59b6;border-radius: 4px;text-decoration:none;" class="backto_list">Back to Roster</a>
                                }
                            </span>
                        </h2>
                    </div>
                </div>

                <div class="col-lg-12">

                    <span class="view-btn backto_listspan" id="BackToList" style="padding-right: 15px;">

                        <a href="#" onclick="AddNewCaseNote('@ViewBag.Client');" class="backto_list">Add New Case Note</a>

                        
                    </span>

                </div>

                <div class="col-xs-12 no-padding">
                    <div class="myframe_midteam">
                    <div class="col-xs-12 no-padding">
                        <div class="col-xs-12 serch-addn-block">

                            <div class="top-header-title-addn1 col-md-4 col-xs-12 no-padding">
                                @if (ViewBag.Name != null && ViewBag.Name != "")
                                {
                                    <h2>@ViewBag.Name</h2>
                                    <span id="clientName" style="color: #285b8f;display:none;">@ViewBag.Name</span>
                                }

                                @*else if (ViewBag.SelectList != null && ((FingerprintsModel.RosterNew.Users)ViewBag.SelectList).Clientlist != null)
                                    {

                                        if (((FingerprintsModel.RosterNew.Users)ViewBag.SelectList).Clientlist.Count == 1)
                                        {
                                            foreach (var clientitem in ((FingerprintsModel.RosterNew.Users)ViewBag.SelectList).Clientlist)
                                            {
                                                <h2>@clientitem.Name</h2>
                                                <span id="clientName" style="color: #285b8f;display:none;">@clientitem.Name</span>
                                            }
                                        }
                                        else
                                        {
                                            <label style="font-size:14px;color:#ffffff;">Select Client</label>
                                            <select id="clientSelect" class="form-control" style="height:38px;">
                                                <option value="0">--Select--</option>

                                                @foreach (var clientitem in ((FingerprintsModel.RosterNew.Users)ViewBag.SelectList).Clientlist)
                                                {
                                                    <option value="@clientitem.Id">@clientitem.Name</option>
                                                }

                                            </select>
                                        }

                                    }*@

                            </div>


                            <div class="col-md-8 col-xs-12 serch-addn-block" style="text-align: right;">
                                <input type="text"  id="txtSearch" placeholder="Search by Tags" class="addn-select" />
                                <div class="addn-search-btn btn-search">
                                    <a href="javascript:void(0);">Search</a>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="UserId" value="@Session["UserId"].ToString()"/>
                        <div class="col-xs-12">
                            <div class="col-sm-12 no-padding block-div" style="background: #f1f5f8;border-radius: 5px;padding:0px;padding-bottom:0;overflow: hidden;">
                                <div id="no-more-tables7" class="col-xs-12 no-padding" style="margin-bottom: 20px;">
                                    <table class="col-md-12 table-striped table-condensed cf table-change addn-table">
                                        <thead class="table-hd scroll-thead">
                                            <tr>
                                                <th>Date</th>
                                                <th>Title</th>
                                                <th>By</th>
                                                <th>Attachments</th>
                                                <th>References</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody class="addn-table-head ersea-table-head bind_body scroll-tbody">

                                                                                        @if (ViewBag.CaseNotelist != null)
                                                                                        {
                                                                                            foreach (var item1 in ViewBag.CaseNotelist)
                                                                                            {
                                                                                                <tr casenoteid="@item1.CaseNoteid">
                                                                                                    <td data-title="Date">
                                                                                                        <div class="addn-content-desc" style="position: relative;">
                                                                                                            <p>@item1.Date</p>
                                                                                                        </div>
                                                                                                    </td>
                                                                                                    @if (item1.IsAllowSecurityCN)
                                                                                                    {
                                                                                                        <td data-title="Title">
                                                                                                          




                                                                                                            <div class="addn-content-desc" style="position: relative;    cursor: pointer;">
                                                                                                                <p data-editable="@(item1.IsEditable ? "true":"false")" style="text-decoration: underline;" onclick="Getcasenote(@item1.CaseNoteid,null,this)">@item1.Title</p>

                                                                                                            </div>

</td>
                                                                                                    }
                                                                                                    else if (item1.WrittenBy == Session["UserId"].ToString() && item1.SecurityLevel)
                                                                                                    {
                                                                                                        <td data-title="Title">
                                                                                                            


                                                                                                            <div data-editable="@(item1.IsEditable ? "true":"false")" class="addn-content-desc" style="position: relative;cursor: pointer;">
                                                                                                                <p style="text-decoration: underline;" onclick="Getcasenote(@item1.CaseNoteid,null,this)">@item1.Title</p>
                                                                                                            </div>


</td>
                                                                                                    }
                                                                                                    else
                                                                                                    {
                                                                                                        <td data-title="Title">
                                                                                                            <div class="addn-content-desc" style="position: relative;    cursor: pointer;">
                                                                                                                <p style="text-decoration: underline;" onclick="ShowSecurityAlert()">Secured case note</p>
                                                                                                            </div>
                                                                                                        </td>
                                                                                                    }
                                                <td data-title="By">
                                                    <div class="addn-content-desc" style="position: relative;">
                                                        <p>@item1.BY</p>
                                                    </div>
                                                </td>
                                                <td data-title="Attachments">
                                                    <div class="addn-content-desc">
                                                        <p>@item1.Attachment</p>
                                                    </div>
                                                </td>
                                                <td data-title="References">
                                                    <div class="addn-content-desc">
                                                        <p>@item1.References</p>
                                                    </div>
                                                </td>
                                                @*<td data-title="Actions" style="width:250px;">*@
                                                <td data-title="Actions">
                                                    <div class="addn-content-desc">
                                                        @if (item1.IsAllowSecurityCN)
                                                        {
                                                            <p style="padding: 5px;width:157px;display:inline-block;">
                                                                <span class="Status-title-addn">

                                                                                                                        <a href="#" data-toggle="modal" class="add-new" style="margin-top: 0;padding-left: 15px;">
                                                                                                                            <span style="width: auto;display: inline-block;margin-right: 2px;font-size: 20px;">+</span>
                                                                                                                            Append Case Note
                                                                                                                        </a>


                                                                </span>
                                                            </p>
                                                        }
                                                        else if (item1.WrittenBy == Session["UserId"].ToString() && item1.SecurityLevel)
                                                        {
                                                            <p style="padding: 5px;width:157px;display:inline-block;">
                                                                <span class="Status-title-addn">

                                                                                                                        <a href="#" data-toggle="modal" class="add-new" style="margin-top: 0;padding-left: 15px;">
                                                                                                                            <span style="width: auto;display: inline-block;margin-right: 2px;font-size: 20px;">+</span>
                                                                                                                            Append Case Note
                                                                                                                        </a>


                                                                </span>
                                                            </p>
                                                        }
                                                        else
                                                        {
                                                            <p style="padding: 5px;height:50px;width:157px;display: inline-block;">

                                                            </p>
                                                        }
                      @if (Role.RolesDictionary[(int)RoleEnum.AgencyAdmin].ToLowerInvariant() == Session["RoleId"].ToString()
                          || Role.RolesDictionary[(int)RoleEnum.GenesisEarthAdministrator].ToLowerInvariant() == Session["RoleId"].ToString())
                      {
                                                        <button type="button" class="btn delete-casenote" style="border-radius: 0px;color: #fff;margin-left: 8px;background: #e43838;" data-id="@item1.CaseNoteid">Delete</button>
                                             }
                                                        @*<i class="fa fa-edit delete-casenote text-info" style="margin-left: 10px;font-size: 23px;" data-id="@item1.CaseNoteid"></i>*@

                                                        @*<i class="fa fa-trash delete-casenote text-danger" style="margin-left: 10px;font-size: 23px;" data-id="@item1.CaseNoteid"></i>*@
                                                    </div>
                                                </td>

                                            </tr>
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                        </div>
                </div>
            </div>

        </div>
    </div>




    <div class="modal fade" id="matrix_addn" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-dialog-ch">

            <!-- Modal content-->
            <div class="modal-content">

                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal"><img src="~/Content/CaseNote/images/close.png" /></button>
                    <h2>Group Case Note</h2>
                    <div class="max_items_addn popup-addn-scroll">
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Date</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-div">
                                    <input class="form-control ui-autocomplete-input casenote-date" onblur="Checkdate(this);" type="text" placeholder="MM/DD/YYYY" value="" readonly="readonly">
                                </div>
                            </div>
                        </div>

                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Role</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-div">
                                    <input class="form-control ui-autocomplete-input appendRole" type="text" placeholder="" value="" readonly="readonly">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Original Note</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-div" style="line-height: 22px;">
                                    <h4>
                                        Posted on <span class="main-date"></span><span>,</span>by<span> @ViewBag.User</span>
                                    </h4>
                                    <div class="main-note">

                                    </div>

                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12" style="padding: 0;">
                            <div class="col-sm-4">

                            </div>
                            <div class="col-sm-8">
                                <div class="col-xs-12 bdr-popup1 no-padding"></div>
                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Append Notes</label>
                                </div>
                            </div>
                            <div class="col-sm-8 sub-notes-details">

                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Clients</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-chk">
                                    <div id="ClientDiv" class="case-note">

                                        @if (ViewBag.Userlist != null && ((List<FingerprintsModel.RosterNew.User>)ViewBag.Userlist) != null)
                                        {
                                            foreach (var item1 in ((List<FingerprintsModel.RosterNew.User>)ViewBag.Userlist))
                                            {
                                                <input type="checkbox" name="" value="@item1.">@item1.Name<br>
                                                @*<div class="col-sm-12"><input type="checkbox" name="ClientIds.IDS" value="@item1.Id" /><span> @item1.Name</span></div>*@
                                            }
                                        }




                                    </div>
                                </div>
                                @*<div class="addn-poup-chk">
                                        <input type="checkbox" name="" value="Brenda Yardly (Parent/Guardian)">Brenda Yardly (Parent/Guardian)<br>
                                        <input type="checkbox" name="" value="Donny Yardley (Others In Household)">Donny Yardley (Others In Household)<br>
                                        <input type="checkbox" name="" value="Michellee Yardly (Child)">Michellee Yardly (Child)
                                    </div>*@
                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Developmental Team</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div id="StaffDiv" class="case-note">
                                    <div class="addn-poup-chk">
                                        @if (ViewBag.Userlist != null && ((List<FingerprintsModel.RosterNew.User>)ViewBag.Userlist) != null)
                                        {
                                            foreach (var item1 in ((List<FingerprintsModel.RosterNew.User>)ViewBag.Userlist))
                                            {
                                                <input type="checkbox" name="" value="@item1.Id">@item1.Name<br>
                                            }
                                        }
                                    </div>
                                </div>
                             
                            </div>
                        </div>
                        
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Download Attachment</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-div">
                                    <div class="download-attachment">

                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--                            <div class="col-xs-12">
                                                        <div class="family-popup-btn">
                                                            <a href="#"><span>+</span>Add Step</a>
                                                        </div>
                                                    </div>-->
                    </div>
                    <!--                        <div class="max_foot_btn">
                                                <div class="lft_btn">
                                                    <a href="#" class="save">SUBMIT</a>
                                                    <a href="#" class="exit">CANCEL</a>
                                                </div>
                                            </div>-->
                </div>
            </div>
        </div>
    </div>





    <div class="modal fade" id="matrix_addn2" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-dialog-ch">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal"><img src="~/Content/CaseNote/images/close.png" /></button>
                    <h2>Append Case Note</h2>
                    <div class="max_items_addn popup-addn-scroll">
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Date</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-div1">
                                    <input class="form-control ui-autocomplete-input casenote-date txt-date" onblur="Checkdate(this);" type="text" placeholder="MM/DD/YYYY" value="">
                                    <input type="hidden" class="hdn-casenoteid" />
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div staff-name">
                                    <label>Name of the staff</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-div1">
                                    <input class="form-control ui-autocomplete-input txt-name" readonly="readonly" type="text" placeholder="Enter the name" value="@ViewBag.User">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Role</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-div1">
                                    <input class="form-control ui-autocomplete-input txt-role" type="text" readonly="readonly" placeholder="Enter the role" value="@ViewBag.Role">
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Original Note</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-div1">
                                    <div id="mainnotes" name="mainnotes" class="form-control ui-autocomplete-input txt-main-note" readonly="readonly" style="height:100px;overflow:auto;"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Appended Notes</label>
                                </div>
                            </div>
                            <div class="col-sm-8 sub-notes-details">

                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Append Note</label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-div1">
                                    <textarea id="subnotes" name="subnotes" class="form-control ui-autocomplete-input txt-note"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Append Tags </label>
                                </div>
                            </div>
                            <div class="col-sm-8">
                                <div class="addn-poup-div1">
                                    <input type="text" id="AppendCaseNotetags" name="AppendCaseNotetags" class="form-control ui-autocomplete-input" />
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 addn-al" style="padding: 0;">
                            <div class="col-sm-4">
                                <div class="addn-poup-div">
                                    <label>Attachment</label>
                                </div>
                            </div>
                            <div class="col-sm-8" style="text-align: left;">
                                @*<input type="text" placeholder="E:\Education Center\Web" class="addn-select1" />
                                    <div class="addn-search-btn1">
                                        <a href="#">Browse</a>
                                    </div>
                                    <div class="addn-search-btn1">
                                        <img src="images/plus-at.png" class="img-responsive" style="margin: 0 0px;position: relative;top: 15px;" />
                                    </div>
                                    <div class="addn-search-btn1">
                                        <p>Add Attachment</p>*@
                                <div class="brow_option">

                                    <div class="attachments-conatiner">

                                        <div class="form-group" style="margin-bottom:10px!important;">
                                            <div style="width:87%;display:inline-block;">
                                                <input type="file" name="img[]" class="file fileAttachments" style="display:none;">
                                                <div class="input-group col-xs-12">
                                                    <input type="text" class="form-control input-lg" disabled placeholder="Upload File">
                                                    <span class="input-group-btn">
                                                        <button class="browse btn btn-primary input-lg" type="button"> Browse</button>

                                                    </span>
                                                </div>
                                            </div>
                                            <div class="AddAttachments" style="width:auto;display:inline-block;vertical-align: top;padding-top: 4px;">
                                                <a href="javascript:void(0);" class="upl">
                                                    <img src="~/Content/EducationMaterial/images/upload.png" class="AddAttachments-1" style="border-radius: 5px;" />
                                                </a>
                                            </div>
                                        </div>



                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12 bdr-popup"></div>
                    <div class="col-xs-12 addn-al" style="padding: 0;">
                        <div class="Status-title-addn btn-save-note" style="text-align: right;">
                            <a style="margin-top: 0;text-transform: uppercase;margin: 0;cursor:pointer;width: auto;display: inline-block;padding: 7px 15px;margin-right: 10px;line-height:22px;">
                                Save
                            </a>
                        </div>
                    </div>


                </div>

        </div>
    </div>
</div>
    </div>





    <!--Delete Case Note Modal-->
<div class="modal fade" id="DeleteCaseNote_Modal" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog modal-dialog-ch">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal"><img src="~/Content/CaseNote/images/close.png" /></button>
                <h2>Delete Case Note</h2>
                <div class="max_items_addn popup-addn-scroll">
                    <div class="col-xs-12 addn-al" style="padding: 0;">
                        
                        <div>
                            <h4>Main Case Note</h4>

                            <table class="table table-bordered table-responsive table-striped" id="mainnote-tbl">
                                <thead><tr><th style="width:100px;">Delete</th><th style="width:200px;">Date</th style="width:15px;"><th>Note</th></tr></thead>
                                <tbody>

                                @*<tr><td><input type="checkbox" name="maincase" /></td>
                                    <td>11/05/2018</td><td>Test String</td></tr>*@
                                
                                </tbody>
                            </table>
                        </div>

                        <div>

                            <h4>Append Case Note</h4>

                            <table class="table table-bordered table-responsive table-striped" id="subnote-tbl">
                                @*<thead><tr><th></th><th>Date</th><th>Note</th></tr></thead>*@
                                <thead><tr><th style="width:100px;">Delete</th><th style="width:200px;">Date</th><th>Note</th></tr></thead>
                                <tbody>

                                

                                </tbody>
                            </table>
                       
                             
                        </div>

                        <div class="col-md-12 text-center" style="margin-top:20px;">
                            <button type="button" class="glossy-button-button button-red" id="deletecasenote_btn">Delete</button>

                            @*<button type="button" class="glossy-button-button button-red" data-dismiss="modal">Cancel</button>*@
                        </div>
                    
                    </div>
                    </div></div></div>

        </div></div>

    @*<script src="~/Content/CaseNote/js/jquery.js"></script>*@
    <script src="~/Content/CaseNote/js/bootstrap.js"></script>
    @*<script src="~/Content/CaseNote/js/script.js"></script>*@
    <script src="~/Content/CaseNote/js/jquery.mCustomScrollbar.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#matrix_addn2').modal('hide');
            var linkys = document.getElementsByClassName('dropdown-toggle');
            for (var i = 0; i < linkys.length; ++i) {
                linkys[i].onclick = function (e) {
                    this.focus();
                    e.preventDefault();
                };
            }


            $('.txt-date').val();
            $('.txt-name').val();
            $('.txt-role').val();
            $('body').on('click', '.dropdown', function () {
                setTimeout(function ()
                { $('.dropdown').addClass('open'); }, 100);

            });

            $('body').on('click', '.add-new', function () {
                $('.hdn-casenoteid').val($(this).closest('tr').attr('casenoteid'));
                $.ajax({
                    type: "POST",
                    url: "/Roster/GetCaseNoteByNoteId",
                    data: { 'NoteId': $(this).closest('tr').attr('casenoteid') },
                    success: function (data) {
                        $('.txt-main-note').empty();
                        var table = JSON.parse(data);
                        $('.txt-main-note').append(table[0].NoteField);
                    
                        $('#matrix_addn2').modal({
                            backdrop: 'static',
                            keyboard: false,
                            show: true,

                        });
                        GetSubNotes($('.hdn-casenoteid').val());

                    },
                    error: function (data) {
                        console.log(data);
                    }

                });






            });
            $('body').on('click', '.remove-attachment', function () {

                $(this).parent().parent().parent().remove();
            });
            $('.btn-save-note').click(function () {
                if (CKEDITOR.instances['subnotes'].getData() == "") {
                    customAlert("Sub Note is required.");
                }
                else {
                    var CaseNote = {};
                    var Tags = '';
                    $('#AppendCaseNotetags_tagsinput .tag span').each(function () {
                        Tags = Tags + $(this).text().trim() + ',';
                    });
                 
                    CaseNote.Note = CKEDITOR.instances['subnotes'].getData().toString().trim();
                    CaseNote.CaseNoteid = $('.hdn-casenoteid').val();
                    CaseNote.CaseNoteDate = $('.txt-date').val();
                    CaseNote.HouseHoldId = $('#HouseHoldId').val();
                    CaseNote.CenterId = $('#CenterId').val();
                    CaseNote.Classroomid = "0";
                    CaseNote.CaseNotetags = Tags;
                    CaseNote = JSON.stringify({ 'CaseNote': CaseNote });
                    $.ajax({
                        type: "POST",
                        url: "/Roster/SaveSubNotes",
                        dataType: "json",
                        contentType: 'application/json; charset=utf-8',
                        async: false,
                        data: CaseNote,
                        success: function (data) {
                            $('#matrix_addn2').modal('hide');
                            SaveFile();
                            setTimeout(function () {
                                Getcasenote1($('.hdn-casenoteid').val());
                                GetSubNotes($('.hdn-casenoteid').val());
                                $('#ModalAddCasenote').modal('hide');
                            
                                $('#matrix_addn').modal({
                                    backdrop: 'static',
                                    keyboard: false,
                                    show: true,

                                });
                                CKEDITOR.instances['subnotes'].setData("");
                                $('.attachments-conatiner .new-file').remove();
                                $('.fileAttachments').val("");
                                $('.input-lg').val("");
                                $('.addn-poup-chk').find('input[type="checkbox"]').attr('disabled', true);
                               // $('.btn-search').click();
                            }, 100);
                        },
                        error: function (data) {
                            console.log(data);
                        }
                    });
                }



            });
            function SaveFile() {
                var data = new FormData();
                $('.fileAttachments').each(function (i, vak) {
                    var files = $(this).get(0).files;
                    console.log(files);
                    console.log($(this).val());
                    if (files.length > 0) {
                        data.append("MyImages" + i + "", files[0]);
                    }
                });

                $.ajax({
                    url: "/Roster/UploadFiles",
                    type: "POST",
                    processData: false,
                    contentType: false,
                    asyn: false,
                    data: data,
                    success: function (data) {
                        console.log(data);

                    },
                    error: function (er) {
                        alert(er);
                    }
                });

            }
            function GetSubNotes(id) {
               
                $.ajax({
                    type: "POST",
                    url: "/Roster/GetSubNotes",
                    async: false,
                    data: { 'CaseNoteId': id },

                                        success: function (data) {
                                            //alert(data);
                                            $('.divAppendedNotes').show();
                                            $('.sub-notes-details').empty();
                                            console.clear();
                                            console.log(data);
                                            debugger;
                                            if (data != null && data.length > 0) {
                                                $(data).each(function (i, val) {
                                                    debugger
                                                    var attachments = '';
                                                    var tagsName = '';
                                                    for (var i = 0; i < val.Attachment.length; i++) {
                                                        if (val.Attachment[i] != "0" && val.Attachment[i] != "")
                                                            attachments += ("<a  title='Click here to download' href='" + HostedDir + "/Agencyuser/getpdfimage1/" + val.Attachment[i] + ",CaseNote,0'><i class='fa fa-download'></i></a>&nbsp;&nbsp;&nbsp;&nbsp;");

                                }
                                for (var i = 0; i < val.Tags.length; i++) {
                                    if (val.Tags[i] != "0" && val.Tags[i] != "")
                                        tagsName += ('<span id="subTags" class="tag-text">'+val.Tags[i]+'</span>');

                                }
                                                    if (tagsName == "") {
                                    tagsName = "<span>No tags available</span>";
                                }
                                var template = '   <div class="addn-poup-div sub-text-block">\
                                             <h4>\
                                                 Posted on <span>{date},</span> by <span>{name}</span>\
                                             </h4>\
                                  <div class="col-xs-12 tag-text-block">\
                                      <label>Tags:</label>\
                                       {SubTags}\
                                </div><div class="col-xs-12 tag-text-block">\
                                 <label>Notes:</label>\
                                    {notes}\
                                      <div id="subAttachments" class="sub-text">\
                                 <label>Attachments:</label>{SubAttach}</div>\
                                </div></div>';
                                         
                                template = template.replace('{date}', val.WrittenDate);
                                template = template.replace('{name}', val.Name);
                                template = template.replace('{notes}', val.Notes);
                                template = template.replace('{SubAttach}', attachments);
                                template = template.replace('{SubTags}', tagsName);
                                $('.sub-notes-details').append(template);
                            });
                        }
                        else {
                            var template = '   <div class="addn-poup-div">\
                                             <h4>\
                                                 No record found\
                                             </h4>\
                                             \
                                         </div>';
                            $('.sub-notes-details').append(template);
                        }




                    },
                    error: function (data) {
                        console.log(data);
                    }
                });
            }
            $('.AddAttachments').click(function () {
                var input = '<div class="form-group">\
                                            <input type="file" name="img[]" class="file fileAttachments" style="display:none;">\
                                            <div class="input-group col-xs-12">\
                                                <input type="text" class="form-control input-lg" disabled placeholder="Upload File">\
                                                <span class="input-group-btn">\
                                                    <button class="browse btn btn-primary input-lg" type="button"> Browse</button>\
                       <img src="/Content/imgs/close_1.png" class="remove-attachment" style="padding-left:5px;">\
                                                </span>\
                                            </div>\
                                        </div>';
                var input = '  <div class="form-group new-file" style="margin-bottom:10px!important;">\
                                                    <div style="width:87%;display:inline-block;">\
                                                        <input type="file" name="img[]" class="file fileAttachments" style="display:none;">\
                                                        <div class="input-group col-xs-12">\
                                                            <input type="text" class="form-control input-lg" disabled placeholder="Upload File">\
                                                            <span class="input-group-btn">\
                                                                <button class="browse btn btn-primary input-lg" type="button"> Browse</button>\
                                                            </span>\
                                                        </div>\
                                                    </div>\
                                                        <div class="AddAttachments" style="width:auto;display:inline-block;vertical-align: top;padding-top: 4px;">\
                                                            <a href="javascript:void(0);" class="upl">\
                                                                <img src="/Content/imgs/close_1.png" class="remove-attachment" />\
                                                            </a>\
                                                        </div>\
                                                    </div>';
                // var input = "<input type='file' name='fileupload' class='fileAttachments' />";
                $('.attachments-conatiner').append(input);
            });

            function getFormattedDate(date) {
                var monthNames = ["January", "February", "March", "April", "May", "June",
"July", "August", "September", "October", "November", "December"
                ];

                var year = date.getFullYear();

                var month = (1 + date.getMonth()).toString();
                month = month.length > 1 ? month : '0' + month;

                var day = date.getDate().toString();
                day = day.length > 1 ? day : '0' + day;
                console.log('month:' + month);
                return monthNames[month] + ' ' + day + ',' + year;
            }


        });
    </script>
    <script type="text/javascript">
        function toggleIcon(e) {
            $(e.target)
                    .prev('.panel-heading')
                    .find(".more-less")
                    .toggleClass('glyphicon-plus glyphicon-minus');
        }
        $('.panel-group').on('hidden.bs.collapse', toggleIcon);
        $('.panel-group').on('shown.bs.collapse', toggleIcon);
        $(document).on('click', '.browse', function () {
            var file = $(this).parent().parent().parent().find('.file');
            file.trigger('click');
        });
        $(document).on('change', '.file', function () {
            $(this).parent().find('.form-control').val($(this).val().replace(/C:\\fakepath\\/i, ''));
        });

    </script>


    <div class="row qualifierdiv">
        <form method="post" enctype="multipart/form-data" role="form" id="form2" autocomplete="off">
            <div class="modal fade scroll-modal" id="ModalAddCasenote" role="dialog">
                <div class="modal-dialog modal-dialog-ch">
                    <div class="modal-content">

                        <div class="modal-body">
                            <button type="button" class="close" data-dismiss="modal"><img src="~/Content/CaseNote/images/close.png" /></button>
                            <h2 id="CaseNoteHeading" class="extra-title muted">Add New Case Note</h2>
                            <div class="col-sm-12 col-xs-12 pull-right" style="padding-right:0;display:none;">
                                <div class="btnwrp_subcal" style="padding:0; margin:0;">
                                    <h3 id="CaseNoteTitle" class="text-center pull-left"><span class="extra-title muted"></span></h3>
                                    <input id="ClientId" type="hidden" name="ClientId" value="@ViewBag.Client" />
                                    <input id="CenterId" type="hidden" name="CenterId" value="@ViewBag.centerid" />
                                    <input id="ProgramId" type="hidden" name="ProgramId" value="@ViewBag.Programid" />
                                    <input id="HouseHoldId" type="hidden" name="HouseHoldId" value="@ViewBag.Householdid" />
                                    <input id="CaseNoteid" type="hidden" name="CaseNoteid" value="0" />
                                    <div class="clear"></div>
                                </div>
                            </div>
                            <div class="max_items_addn popup-addn-scroll">
                                <div class="col-xs-12 addn-al" style="padding: 0;">
                                    <div class="col-sm-4">
                                        <div class="addn-poup-div">
                                            <label>Date <sup style="color:red">*</sup></label>
                                        </div>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="addn-poup-div1">
                                            <input type="text" id="CaseNoteDate" name="CaseNoteDate" onblur="Checkdate(this);" placeholder="MM/DD/YYYY" class="form-control ui-autocomplete-input casenote-date" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12 addn-al" style="padding: 0;">
                                    <div class="col-sm-4">
                                        <div class="addn-poup-div">
                                            <label>Title <sup style="color:red">*</sup></label>
                                        </div>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="addn-poup-div1">
                                            <input type="text" maxlength="100" id="CaseNotetitle" name="CaseNotetitle" class="form-control ui-autocomplete-input" />
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-12 addn-al" style="padding: 0;">
                                    <div class="col-sm-4">
                                        <div class="addn-poup-div">
                                            <label>Note <sup style="color:red">*</sup></label>
                                        </div>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="addn-poup-div1">
                                            <textarea id="Note" name="Note"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12 addn-al divAppendedNotes" style="padding: 0;display:none;">
                                    <div class="col-sm-4">
                                        <div class="addn-poup-div">
                                            <label>Appended Notes</label>
                                        </div>
                                    </div>
                                    <div class="col-sm-8 sub-notes-details">

                                    </div>
                                </div>
                                <div class="col-xs-12 addn-al" style="padding: 0;">
                                    <div class="col-sm-4">
                                        <div class="addn-poup-div">
                                            <label>Clients  <sup style="color:red">*</sup></label>
                                        </div>
                                    </div>
                                    <div class="col-sm-8" style="padding: 0;">
                                        <div id="ClientDiv" class="case-note">

                                            @if (ViewBag.Clientlist != null && ((List<FingerprintsModel.RosterNew.User>)ViewBag.Clientlist) != null)
                                            {
                                                foreach (var item1 in ((List<FingerprintsModel.RosterNew.User>)ViewBag.Clientlist))
                                                { 
                                                    <div class="col-sm-12"><input type="checkbox" name="ClientIds.IDS" value="@item1.Id" /><span> @item1.Name</span></div>
                                                }
                                            }
                                        </div>

                                    </div>
                                </div>
                                <div class="col-xs-12 addn-al" style="padding: 0;">
                                    <div class="col-sm-4">
                                        <div class="addn-poup-div">
                                            <label>Tags <sup style="color:red">*</sup> </label>
                                        </div>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="addn-poup-div1">
                                            <input type="text" id="CaseNotetags" name="CaseNotetags" class="form-control ui-autocomplete-input" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-xs-12 addn-al" style="padding: 0;">

                                    @if (ViewBag.Householdid != null && ViewBag.Householdid == "0")
                                    {
                                        <div class="col-sm-12 adddivspace">
                                            <div class="col-sm-4">
                                                <div class="addn-poup-div">
                                                    <label>Developmental Team</label>
                                                </div>
                                            </div>
                                            <div class="col-sm-8" id="Divstaff" style="padding: 0;">
                                                <div id="StaffDiv" class="case-note">

                                                    @if (ViewBag.Userlist != null && ((List<FingerprintsModel.RosterNew.User>)ViewBag.Userlist) != null)
                                                    {
                                                        foreach (var item1 in ((List<FingerprintsModel.RosterNew.User>)ViewBag.Userlist))
                                                        {
                                                            <div class="col-sm-12"><input type="checkbox" name="TeamIds.IDS" value="@item1.Id" /><span> @item1.Name</span></div>
                                                        }
                                                    }

                                                </div>

                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="col-sm-12 adddivspace">
                                            <div class="col-sm-4">
                                                <div class="addn-poup-div">
                                                    <label>Developmental Team</label>
                                                </div>
                                            </div>
                                            <div class="col-sm-8" id="Divstaff">
                                                <div id="StaffDiv" class="case-note">

                                                    @if (ViewBag.Userlist != null && ((List<FingerprintsModel.RosterNew.User>)ViewBag.Userlist) != null)
                                                    {
                                                        foreach (var item1 in ((List<FingerprintsModel.RosterNew.User>)ViewBag.Userlist))
                                                        {
                                                            <div class="col-sm-12"><input type="checkbox" name="TeamIds.IDS" value="@item1.Id" /><span> @item1.Name</span></div>
                                                        }
                                                    }

                                                </div>

                                            </div>
                                        </div>

                                    }
                                </div>
                                <div class="col-xs-12 addn-al" style="padding: 0;">
                                    <div class="col-sm-4">
                                        <div class="addn-poup-div">
                                            <label>Secure Note ?</label>
                                        </div>
                                    </div>
                                    <div class="col-sm-8">
                                        <div class="addn-poup-div1">
                                            <input type="checkbox" id="CaseNoteSecurity"  value="true" name="CaseNoteSecurity" style="margin-left:5px;" />
                                            <span>Yes</span>
                                        </div>
                                    </div>
                                </div>
                               
                                <div class="col-xs-12 addn-al" style="padding: 0;">
                                    <div id="Attachment">
                                        <div class="col-sm-12 adddivspace" style="padding: 0;">
                                            <div class="col-sm-4">
                                                <div class="addn-poup-div">
                                                    <label>Attachment</label>
                                                </div>
                                            </div>
                                            <div class="col-sm-5">
                                                <input type="file" id="FirstFile" name="Attachments[0].file" onchange="ValidateSingleInputpdf2(this)" class="form-control" />
                                            </div>
                                            <div class="col-sm-3 adddivspace add-attach-btn">
                                                @*<span>Add Attachment </span>*@
                                                <a href="javascript:void(0)" id="Attachmectstag" title="Add Attachment"><i class="fa fa-plus-circle"></i> Add</a>

                                            </div>
                                        </div>
                                    </div>
                                    <div id="Attachments" style="display:none;">
                                        <div class="col-sm-12 adddivspace" style="padding: 0;">
                                            <div class="col-sm-4">
                                                <div class="addn-poup-div">
                                                    <label>Download Attachment</label>
                                                </div>
                                            </div>
                                            <div id="Attach" class="col-sm-8 adddivspace">


                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="col-xs-12 bdr-popup"></div>
                            <div class="col-xs-12" style="margin-top:10px;margin-bottom:15px;">
                                <div class="btnwrp_subcal" style="padding:0; margin:0;">
                                    <button type="submit" id="SaveNoteSubmit" onclick="return Validatecasenote();" class="my-btn pull-right" style="background:#2ecc71;">Save</button>
                                    <button type="button" class="my-btn pull-right" data-dismiss="modal" style="background:#db4437;">Exit</button>
                                </div>
                            </div>
                        </div>



                    </div>
                </div>
            </div>
        </form>
    </div>
}

