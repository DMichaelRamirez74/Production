@*@model FingerprintsModel.ParentInfoModel*@

@{
    ViewBag.Title = "ParentContactInfo";
    Layout =(Session["RoleID"].ToString()== "a65bb7c2-e320-42a2-aed4-409a321c08a5" || Session["RoleID"].ToString() == "3b49b025-68eb-4059-8931-68a0577e5fa2") ? "~/Views/Shared/AgencyAdminLayout.cshtml" : "~/Views/Shared/AgencyStaffLayout.cshtml";
    }


    @section MainContentHolder{
    <link href="~/Content/css/parentcontact.css" rel="stylesheet" />
    @*<link href="~/Content/css/jquery.mCustomScrollbar.min.css" rel="stylesheet" />*@
    <script src="~/Scripts/ClientFileReview/jquery.mCustomScrollbar.min.js"></script>

    <style>
        #page-wrapper {
            padding-left: 0;
            padding-right: 0;
        }

        select option {
            background: #164273;
        }

        .scroll-thead th {
            border: 1px solid #f1f5f8;
        }

        .scroll-thead {
            display: table;
            width: 100%;
            table-layout: fixed;
            width: 98.3%;
        }

        .scroll-tbody tr td, .scroll-tbody1 tr td {
            word-break: break-word;
        }

        .scroll-tbody {
            display: block;
            height: 250px;
            overflow: auto;
            overflow-x: hidden;
        }

            .scroll-tbody tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }

        .scroll-tbody1 {
            display: block;
        }

            .scroll-tbody1 tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }

        /*on-hover Assessment Group Text*/

        .childName .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            /*top: 28px;*/
            left: 128px;
            line-height: 25px;
        }

            /*.childName .tooltiptext::after {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent black transparent;
        }*/
            .childName .tooltiptext::after {
                content: " ";
                position: absolute;
                top: 50%;
                right: 100%; /* To the left of the tooltip */
                margin-top: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: transparent black transparent transparent;
            }

        .childName:hover .tooltiptext {
            visibility: visible;
        }

        .ersea-table thead tr th, .ersea-table-head p {
            font-size: 14px;
        }

        .row-phone {
            line-height: 30px;
        }

        .phone-table {
            width: 100%;
        }

            .phone-table tr td {
                background: #fff !important;
                border: solid 1px #e7e7e7;
                padding: 5px;
            }

        .call-btn {
            width: 100%;
            border: none;
            padding: 5px 0;
            margin-bottom: 5px;
            font-size: 12px;
            color: #fff;
        }


        .child-row:nth-child(even) td, .child-row:nth-child(even) td p {
            background: #ccc0 !important;
        }

        .child-row:nth-child(odd) td, .child-row:nth-child(odd) p {
            background: #FFF !important;
        }

        /*.tooltip {
            position: absolute;
            background-color: #eeeefe;
            border: 1px solid #aaaaca;
            font-size: smaller;
            padding: 4px;
            width: 160px;
            box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
            -moz-box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
            -webkit-box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
        }*/



        [tooltip]:before {
    /* needed - do not touch */
    content: attr(tooltip);
    position: absolute;
    opacity: 0;
    
    /* customizable */
    transition: all 0.15s ease;
    padding: 10px;
    color: #333;
    border-radius: 10px;
    box-shadow: 2px 2px 1px silver;    
}

[tooltip]:hover:before {
    /* needed - do not touch */
    opacity: 1;
    
    /* customizable */
    background: yellow;
    margin-top: -50px;
    margin-left: 20px;    
}

[tooltip]:not([tooltip-persistent]):before {
    pointer-events: none;
}

    </style>

    <div class="container-fluid">
        <div class="row">
            <div class="right-side-container-ch">
                <div class="col-xs-12 no-padding">
                    <div class="col-xs-12 no-padding">
                        <div class="col-xs-12 ersea-detl-title">
                            <h2>Parent Contact Information</h2>
                            <div class="ersea_ovr"><img src="~/images/text-bdr.png" class="img-responsive"></div>
                        </div>
                        <div class="col-xs-12">
                            <div class="col-lg-3 col-sm-6">


                                @Html.DropDownList("ddlCenterDetails", Fingerprints.Utilities.Helper.GetCentersByUserId(Session["UserId"].ToString(), Session["AgencyID"].ToString(), Session["RoleID"].ToString()), new { @class = "ersa-select center-select width-select-change" })



                                @*@if (Model.CenterList != null)
                                    {
                                        if (Model.CenterList.Count() > 0)
                                        {
                                            if (Model.CenterList.Count() == 1)
                                            {
                                                <select class="ersa-select center-select width-select-change">
                                                    <option value="@Model.CenterList[0].CenterId">@Model.CenterList[0].CenterName</option>
                                                </select>
                                            }
                                            else
                                            {
                                                <select class="ersa-select center-select width-select-change">
                                                    <option value="0">All Centers</option>

                                                    @foreach (var center in Model.CenterList)
                                                    {
                                                        <option value="@center.CenterId">@center.CenterName</option>
                                                    }

                                                </select>
                                            }
                                        }
                                    }*@


                            </div>
                            <div class="col-lg-3 col-sm-6">
                                <select class="ersa-select select-classroom width-select-change" id="classroomSelect">
                                    <option value="0">--Select Classroom--</option>
                                </select>
                            </div>
                            <div class="col-lg-3 col-sm-6">
                                <select class="ersa-select select-filter width-select-change">
                                    <option value="0">--Filter Type--</option>
                                    <option value="1">No Email</option>
                                    <option value="2">No SMS</option>
                                </select>

                            </div>
                            <div class="col-lg-3 col-sm-6 ersa-search-btn">
                                <a href="javascript:void(0);" id="searchByfilter" style="padding: 10px 9px;">Search</a>
                            </div>
                        </div>


                        <div id="no-more-tables8" class="col-xs-12 no-padding" style="margin-bottom: 20px;">
                            <div class="col-xs-12" style="border-radius: 10px;background: #f1f5f8;padding: 10px;width: 98%;margin:20px 1%;">
                                <div class="col-xs-12" style="margin-bottom:10px;">

                                    <div class="col-md-6 text-left" style="margin-top:10px;font-size:12px;">
                                        <label><span style="color:rgb(63, 81, 181);">H-Home Phone</span>&nbsp;<span style="color:rgb(0, 150, 136);">M-Mobile Phone</span>&nbsp;<span style="color:rgb(121, 85, 72);">W-Work Phone</span></label>
                                    </div>

                                    <div class="col-md-6 text-right">
                                        <input type="text" placeholder="Search by Name or Email" id="searchText" style="color:#333;font-size:14px;margin-right:0;width: 220px!important;line-height:32px;padding:0px 10px;" />
                                        <div class="ersa-search-btn" style="width:auto;display:inline-block;">
                                            <a href="javascript:void(0);" id="searchByemailName" style="border-radius:0;font-size: 14px;background: #174777;color: #fff;">Search</a>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-12 text-left">
                                    <label style="color:#1d5381;">Total Count : <span id="totalCountSpan">0</span></label>

                                </div>

                                <table class="col-md-12 table-striped table-condensed cf table-change ersea-table" id="centerTable">
                                    <thead class="table-hd scroll-thead">
                                        <tr>
                                            <th>Client</th>
                                            <th>Parent Name</th>
                                            <th style="width: 13%;">Center </th>
                                            <th  style="width: 13%;">Classroom</th>
                                            <th style="width:7%;">Email</th>
                                            <th>Phone No</th>
                                            <th style="width: 8%;">SMS</th>
                                            <th style="width:10%;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody class="ersea-table-head bind_body scroll-tbody">


                                        @*@if (Model.ParentInfoList.Count() > 0)
                                            {
                                                var i = 0;
                                                foreach (var item in Model.ParentInfoList)
                                                {

                                                    <tr class="child-row">
                                                        <td data-title="Client" rowspan="3">
                                                            <p class="client-name" style="cursor:pointer;" accesskey="@item.ClientId">@item.ChildName</p>
                                                        </td>
                                                        <td data-title="Parent Name" rowspan="3">
                                                            <p class="parent-name">@Html.Raw(item.ParentName)</p>

                                                        </td>
                                                        <td data-title="Center" rowspan="3">
                                                            <p class="center-name" accesskey="@item.CenterId">@item.CenterName</p>
                                                        </td>
                                                        <td data-title="Classroom" rowspan="3">
                                                            <p class="classroom-name" accesskey="@item.ClassRoomId">@item.ClassRoomName</p>
                                                        </td>
                                                        <td data-title="Email" style="width:7%;">
                                                            <a class="email-id" href="#" data-toggle="tooltip"  data-placement="top"  title="@Html.Raw(item.EmailId)" style="text-align:center;">@(item.EmailId == "" ? "No" : "Yes")</a>
                                                        </td>

                                                        <td data-title="Phone No">
                                                            <table class="phone-table phone-no-table">
                                                                <tr style="line-height:normal;">
                                                                 <td style="color:#3F51B5;font-weight: bold;font-size: 11px;width:15%;" class="lbl_home_@i">H</td>
                                                                <td style="font-size: 11px;font-weight: bold;" class="home_@i">@(item.HomePhone == "" ? "N/A" : item.HomePhone )</td></tr>

                                                                <tr style="line-height:normal;">
                                                                    <td style="color: #009688;font-weight: bold;font-size: 11px;width:15%;" class="lbl_mobile_@i">M</td>
                                                                <td style="font-size: 11px;font-weight: bold;" class="mobile_@i">@(item.MobilePhone == "" ? "N/A" : item.MobilePhone )</td></tr>
                                                                <tr style="line-height:normal;">
                                                                <td style="color: #795548;font-weight: bold;font-size: 11px;width:15%;" class="lbl_work_@i">W</td>
                                                                <td style="font-size: 10px;font-weight: bold; font-size: 11px;" class="work_@i">@(item.WorkPhone == "" ? "N/A" : item.WorkPhone )</td></tr>
                                                            </table>
                                                        </td>

                                                        <td data-title="Accept SMS" style="width:8%;">

                                                            <table class="phone-table">
                                                                <tr style="line-height:normal;"><td class="lbl_home_@i">@(item.IsSmsHomePhone ? "Yes" : "No")</td></tr>
                                                                <tr style="line-height:normal;"><td class="lbl_mobile_@i">@(item.IsSmsMobilePhone ? "Yes" : "No")</td></tr>
                                                                <tr style="line-height:normal;"><td class="lbl_work_@i">@(item.IsSmsWorkPhone ? "Yes" : "No")</td></tr>
                                                            </table>
                                                        </td>

                                                        <td data-title="Action" style="width:10%;">
                                                            <button class="call-btn" style="background:#4CAF50;">Call</button>
                                                            @if (!item.NoEmail)
                                                            {
                                                                <button class="call-btn" style="background:#2196F3;">Email</button>
                                                            }

                                                            @if (item.IsSmsHomePhone || item.IsSmsMobilePhone || item.IsSmsWorkPhone)
                                                            {
                                                                <button class="call-btn" style="background:#FF5722;">Send SMS</button>

                                                            }
                                                        </td>
                                                    </tr>

                                                    i++;
                                                }
                                            }

                                            else
                                            {
                                                <tr style="width:98.3%">
                                                    <td colspan="9" style="padding: 25px;text-align:center;">Records Not Found</td>
                                                </tr>
                                            }*@


                                        <tr style="width:98.3%">
                                            <td colspan="9" style="padding: 25px;text-align:center;font-weight:bold;">Search by Center and Classroom<sup style="color:red;">*</sup></td>
                                        </tr>

                                    </tbody>



                                </table>


                            </div>
                        </div>




                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-----Div Cal Table-->

    <table class="bindTable hidden">
        <tr>
            <td data-title="Center Name">
                <p class="center-name" style="text-decoration:underline;cursor:pointer;"></p>
            </td>
            <td data-title="Seats">
                <p class="seats-count"></p>
            </td>
            <td data-title="Enrolled">
                <p class="enroll-count"></p>
            </td>
            <td data-title="Withdrawn">
                <p class="withdrawn-count"></p>
            </td>
            <td data-title="Dropped">
                <p class="dropped-count"></p>
            </td>
            <td data-title="Waiting">
                <p class="waiting-count" style="text-align:right;padding-bottom:20px;"></p>
            </td>

            <td data-title="Return">
                <p class="return-count"></p>
            </td>
            <td data-title="Grad">
                <p class="grad-count"></p>
            </td>
            <td data-title="O/I">
                <p class="oi-count"></p>
            </td>
            <td data-title="Foster">
                <p class="foster-count"></p>
            </td>
            <td data-title="Homeless">
                <p class="homeless-count"></p>
            </td>
            <td data-title="Leads">
                <p class="leads-count"></p>
            </td>
        </tr>
    </table>


    <script>
        $(function () {
            var centerIdSelect = $('.center-select');
            var classRoomIdSelect = $('.select-classroom');
            var filterTypeSelect = $('.select-filter');
            var searchText = $('#searchText');



            //if ($('.scroll-tbody').children('.child-row').length <= 2) {
            //    $('.scroll-tbody').children('.child-row').each(function (i, row) {
            //        $(row).css({ 'width': '98.3%' });
            //    });
            //}
            //else if ($('.scroll-tbody').children('.child-row').length > 2) {
            //    $('.scroll-tbody').children('.child-row').each(function (i, row) {
            //        $(row).css({ 'width': '100%' });
            //    });
            //}

            $(window).bind("load resize", function () {

                topOffset = 50;
                width = (this.window.innerWidth > 0) ? this.window.innerWidth : this.screen.width;
                if (width < 768) {
                    topOffset = 100; // 2-row-menu
                }

                height = ((this.window.innerHeight > 0) ? this.window.innerHeight : this.screen.height) - 1;

                height = height - topOffset;
                if (height < 1) height = 1;
                if (height > topOffset) {
                    var fileHeight = height - 25;

                    $('.right-side-container-ch').css('min-height', (fileHeight - 5) + 'px');
                    $('.scroll-tbody').height(fileHeight - 317);
                }

                //reSizeContent();
            });



            function getListByFilter() {

                $('#spinner').show();
                $.ajax({
                    url: '/Home/GetParentInfoBySearch',
                    datatype: 'json',
                    type: 'post',
                    data: { centerId: parseInt(centerIdSelect.val()), classRoomId: parseInt(classRoomIdSelect.val()), filterType: parseInt(filterTypeSelect.val()), searchText: searchText.val().trim() },
                    success: function (data) {

                        var appendData = '';
                        var totalCount = 0;
                        var noRecordTmp = '<tr style="width:98.3%"><td colspan="9" style="padding: 25px;text-align:center;">Records Not Found</td></tr>';
                        if (data != null) {
                            if (data.ParentInfoList != null) {
                                if (data.ParentInfoList.length > 0) {

                                    totalCount = (data.ParentInfoList.length > 0 && data.ParentInfoList.length < 10) ? '0' + data.ParentInfoList.length : data.ParentInfoList.length;

                                    $.each(data.ParentInfoList, function (i, info) {

                                        var phoneString = '';

                                        phoneString += ' <button class="call-btn" style="background:#4CAF50;">Call</button>';

                                        if (!info.NoEmail) {
                                            phoneString += '<button class="call-btn" style="background:#2196F3;">Email</button>';
                                        }
                                        if (info.IsSmsHomePhone || info.IsSmsMobilePhone || info.IsSmsWorkPhone) {
                                            phoneString += '<button class="call-btn" style="background:#FF5722;">Send SMS</button>';
                                        }

                                        var IsHomeSms = (info.IsSmsHomePhone) ? 'Yes' : 'No';
                                        var IsMobileSms = (info.IsSmsMobilePhone) ? 'Yes' : 'No';
                                        var IsWorkSms = (info.IsSmsWorkPhone) ? 'Yes' : 'No';

                                        var HomeNo = (info.HomePhone == '') ? 'N/A' : info.HomePhone;
                                        var MobileNo = (info.MobilePhone == '') ? 'N/A' : info.MobilePhone;
                                        var WorkNo = (info.WorkPhone == '') ? 'N/A' : info.WorkPhone;

                                        var Email = (info.EmailId == '') ? '' : info.EmailId;
                                        var isEmail = (info.EmailId == '') ? 'No' : 'Yes';
                                        appendData += '<tr class="child-row">\
                                                    <td data-title="Client" rowspan="3">\
                                                        <p class="client-name" style="cursor:pointer;" accesskey='+ info.ClientId + '>' + info.ChildName + '</p>\
                                                    </td>\
                                                    <td data-title="Parent Name" rowspan="3">\
                                                        <p class="parent-name">'+ info.ParentName + '</p>\
                                                    </td>\
                                                    <td data-title="Center" rowspan="3" class="icc-center">\
                                                      <p>  <a class="center-name" href="#" title="'+info.CenterName+'" accesskey='+ info.CenterId + ' >' + info.CenterName + '</a></p>\
                                                    </td>\
                                                    <td data-title="Classroom" rowspan="3" class="icc-center"">\
                                                       <p> <a class="classroom-name" href="#"  title="'+info.ClassRoomName+'" accesskey='+ info.ClassRoomId + '>' + info.ClassRoomName + '</a></p>\
                                                    </td>\
                                                    <td data-title="Email" class="icc-email">\
                                                        <a class="email-id" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.EmailId + '"  style="text-align:center;">' + isEmail + '</a>\
                                                    </td>\
                                                    <td data-title="Phone No">\
                                                        <table class="phone-table phone-no-table">\
                                                            <tbody><tr style="line-height:normal;">\
                                                            <td style="color: rgb(63, 81, 181); font-weight: bold; font-size: 11px; width: 15%; height: 24px;" class="lbl_home_' + i + '">H</td>\
                                                            <td style="font-size: 11px;font-weight: bold;" class="home_'+ i + '">' + HomeNo + '</td></tr>\
                                                            <tr style="line-height:normal;">\
                                                            <td style="color: rgb(0, 150, 136); font-weight: bold; font-size: 11px; width: 15%; height: 24px;" class="lbl_mobile_' + i + '">M</td>\
                                                            <td style="font-size: 11px;font-weight: bold;" class="mobile_' + i + '">' + MobileNo + '</td></tr>\
                                                            <tr style="line-height:normal;">\
                                                            <td style="color: rgb(121, 85, 72); font-weight: bold; font-size: 11px; width: 15%; height: 24px;" class="lbl_work_' + i + '">W</td>\
                                                            <td  style="font-size: 11px;font-weight: bold;" class="work_' + i + '">' + WorkNo + '</td></tr>\
                                                        </tbody></table>\
                                                    </td>\
                                                    <td data-title="SMS" class="phn-tabrate">\
                                                        <table class="phone-table">\
                                                            <tbody><tr style="line-height:normal;"><td class="lbl_home_'+ i + '" style="height: 23px;">' + IsHomeSms + '</td></tr>\
                                                            <tr style="line-height:normal;"><td class="lbl_mobile_'+ i + '" style="height: 28px;">' + IsMobileSms + '</td></tr>\
                                                            <tr style="line-height:normal;"><td class="lbl_work_'+ i + '" style="height: 28px;">' + IsWorkSms + '</td></tr>\
                                                        </tbody></table>\
                                                    </td>\
                                                    <td data-title="Action" style="width:10%;">' + phoneString + '</td>\
                                                </tr>';

                                    });

                                    $('.scroll-tbody').html(appendData);


                                    if (document.documentMode || /Edge/.test(navigator.userAgent)) {

                                        if (data.ParentInfoList.length <= 2) {
                                            //$('.scroll-tbody').children('.child-row').each(function (i, row) {
                                            //    $(row).css({ 'width': '98.3%' });
                                            //});
                                            $('.scroll-tbody').css({ 'width': '98.3%' });
                                        }
                                        else {
                                            //$('.scroll-tbody').children('.child-row').each(function (i, row) {
                                            //    $(row).css({ 'width': '100%' });
                                            //});
                                            $('.scroll-tbody').css({ 'width': '99.4%' });
                                        }
                                       
                                    }


                                    else if (data.ParentInfoList.length <= 2) {
                                        //$('.scroll-tbody').children('.child-row').each(function (i, row) {
                                        //    $(row).css({ 'width': '98.3%' });
                                        //});
                                        $('.scroll-tbody').css({ 'width': '98.3%' });
                                    }
                                    else {
                                        //$('.scroll-tbody').children('.child-row').each(function (i, row) {
                                        //    $(row).css({ 'width': '100%' });
                                        //});
                                        $('.scroll-tbody').css({ 'width': '100%' });
                                    }
                                }
                                else {

                                    $('.scroll-tbody').html(noRecordTmp);

                                }

                            }
                            else {

                                $('.scroll-tbody').html(noRecordTmp);

                            }
                        }
                        else {

                            $('.scroll-tbody').html(noRecordTmp);

                        }
                        $('#totalCountSpan').text(totalCount);

                        $('#spinner').hide();
                    },
                    error: function (data) {
                        $('#spinner').hide();
                        alert('error');

                    }

                })

            }

            $('.scroll-tbody').find('.phone-no-table').each(function (i, table) {
                $(table).find('td').each(function (j, td) {

                    var clas = $(td).attr('class');
                    var hgt = $(td).height();
                    $('.lbl_' + clas + '').height(hgt);
                });
            });

            $('.center-select').on('change', function () {

                var centerId = $(this).val();
                if (centerId == '0') {
                    $('.select-classroom').html('<option value="0">--Select Classroom--</option>');
                    $('.select-filter').val(0);
                    var searchRow = '<tr style="width:98.3%">\
                                            <td colspan="9" style="padding: 25px;text-align:center;">Search by Center and Classroom<sup style="color:red;">*</sup></td>\
                                        </tr>';
                    $('.scroll-tbody').html(searchRow);
                }
                else {
                    $.ajax({
                        url: "/AgencyUser/GetClassByCenterID",
                        datatype: 'json',
                        type: 'post',
                        data: { CenterID: centerId },
                        success: function (data) {
                            if (data.length > 0) {
                                var classroom = '<option value="0">--Select Classroom--</option>';

                                if (data.length === 1) {
                                    classroom = '<option value=' + data[0].ClassRoomId + '>' + data[0].ClassRoomName + '</option>';
                                    $('.select-classroom').html(classroom);
                                }

                                else {
                                    $.each(data, function (i, element1) {
                                        classroom += '<option value=' + element1.ClassRoomId + '>' + element1.ClassRoomName + '</option>';
                                    });
                                    $('.select-classroom').html(classroom);
                                }
                                //if (data.length === 1) {
                                //    $('.select-classroom').val(data[0].ClassRoomId);
                                //}
                            }
                        },
                        error: function (data) {

                        }
                    });
                }
            });

            $('#searchByfilter').on('click', function () {

                cleanValidation();
                if ($('.center-select').val() === '0') {
                    plainValidation('#ddlCenterDetails');
                    customAlert('Please Select Center');
                    return false;
                }
                else if ($('.select-classroom').val() === '0') {
                    plainValidation('#classroomSelect');
                    customAlert('Please Select Classroom');
                    return false;
                }
                getListByFilter();

            });

            $('#searchByemailName').on('click', function () {

                getListByFilter();

            });

        });
    </script>




}
