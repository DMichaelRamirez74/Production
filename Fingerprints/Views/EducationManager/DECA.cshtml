@*@model FingerprintsModel.ParentInfoModel*@

@{
    ViewBag.Title = "ScreeningAnalysisInfo";
    Layout =  "~/Views/Shared/AgencyStaffLayout.cshtml";
}


@section MainContentHolder{
    <link href="~/Content/css/parentcontact.css" rel="stylesheet" />
    @*<link href="~/Content/css/jquery.mCustomScrollbar.min.css" rel="stylesheet" />*@
    <script src="~/Scripts/ClientFileReview/jquery.mCustomScrollbar.min.js"></script>

    <style>
        #page-wrapper {
            padding-left: 0;
            padding-right: 0;
        }

        select option {
            background: #164273;
        }

        .scroll-thead th {
            border: 1px solid #f1f5f8;
        }

        .scroll-thead {
            display: table;
            width: 100%;
            table-layout: fixed;
            width: 98.3%;
        }

        .scroll-tbody tr td, .scroll-tbody1 tr td {
            word-break: break-word;
        }

        .scroll-tbody {
            display: block;
            height: 250px;
            overflow: auto;
            overflow-x: hidden;
        }

            .scroll-tbody tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }

        .scroll-tbody1 {
            display: block;
        }

            .scroll-tbody1 tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }

        /*on-hover Assessment Group Text*/

        .childName .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: black;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            /*top: 28px;*/
            left: 128px;
            line-height: 25px;
        }

            /*.childName .tooltiptext::after {
            content: "";
            position: absolute;
            bottom: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: transparent transparent black transparent;
        }*/
            .childName .tooltiptext::after {
                content: " ";
                position: absolute;
                top: 50%;
                right: 100%; /* To the left of the tooltip */
                margin-top: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: transparent black transparent transparent;
            }

        .childName:hover .tooltiptext {
            visibility: visible;
        }

        .ersea-table thead tr th, .ersea-table-head p {
            font-size: 14px;
        }

        .row-phone {
            line-height: 30px;
        }

        .phone-table {
            width: 100%;
        }

            .phone-table tr td {
                background: #fff !important;
                border: solid 1px #e7e7e7;
                padding: 5px;
            }

        .call-btn {
            width: 100%;
            border: none;
            padding: 5px 0;
            margin-bottom: 5px;
            font-size: 12px;
            color: #fff;
        }


        .child-row:nth-child(even) td, .child-row:nth-child(even) td p {
            background: #ccc0 !important;
        }

        .child-row:nth-child(odd) td, .child-row:nth-child(odd) p {
            background: #FFF !important;
        }

        /*.tooltip {
            position: absolute;
            background-color: #eeeefe;
            border: 1px solid #aaaaca;
            font-size: smaller;
            padding: 4px;
            width: 160px;
            box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
            -moz-box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
            -webkit-box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
        }*/



        [tooltip]:before {
            /* needed - do not touch */
            content: attr(tooltip);
            position: absolute;
            opacity: 0;
            /* customizable */
            transition: all 0.15s ease;
            padding: 10px;
            color: #333;
            border-radius: 10px;
            box-shadow: 2px 2px 1px silver;
        }

        [tooltip]:hover:before {
            /* needed - do not touch */
            opacity: 1;
            /* customizable */
            background: yellow;
            margin-top: -50px;
            margin-left: 20px;
        }

        [tooltip]:not([tooltip-persistent]):before {
            pointer-events: none;
        }
    </style>

    <div class="container-fluid">
        <div class="row">
            <div class="right-side-container-ch">
                <div class="col-xs-12 no-padding">
                    <div class="col-xs-12 no-padding">
                        <div class="col-xs-12 ersea-detl-title">
                            <h2>DECA Analysis</h2>
                            <div class="ersea_ovr"><img src="~/images/text-bdr.png" class="img-responsive"></div>
                        </div>
                        <div class="col-xs-12">
                            <div class="col-lg-3 col-sm-6">


                                @Html.DropDownList("ddlCenterDetails", Fingerprints.Utilities.Helper.GetCentersByUserId(Session["UserId"].ToString(), Session["AgencyID"].ToString(), Session["RoleID"].ToString()), new { @class = "ersa-select center-select width-select-change" })



                            </div>
                            <div class="col-lg-3 col-sm-6">
                                <select class="ersa-select select-classroom width-select-change" id="classroomSelect">
                                    <option value="0">--Select Classroom--</option>
                                </select>
                            </div>
                            <div class="col-lg-3 col-sm-6">
                                <select class="ersa-select select-filter width-select-change">
                                    <option value="0">--Filter Type--</option>
                                    <option value="1">Re-screen</option>
                                  
                                </select>

                            </div>
                            <div class="col-lg-3 col-sm-6 ersa-search-btn">
                                <a href="javascript:void(0);" id="searchByfilter" style="padding: 10px 9px;">Search</a>
                            </div>
                        </div>


                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 table-main">
                            <div class="col-xs-12" style="border-radius: 10px;background: #f1f5f8;padding: 10px;width: 98%;margin:20px 1%;">


                                <div class="col-xs-12 text-left">
                                    <label style="color:#1d5381;">Total Count : <span id="totalCountSpan">0</span></label>

                                </div>


                                <table class="table table_size" id="GridRoster">
                                    <thead class="table-hd scroll-thead">
                                        <tr>
                                            <th>Client</th>
                                            <th>DOB</th>
                                            <th>Center </th>
                                            <th>Classroom</th>
                                            <th>Initial Parent DECA Date</th>
                                            <th>Completed By</th>
                                            <th>Relation to Child</th>
                                            <th>Areas of Need</th>
                                            <th>Initial Teacher / Home Visitor DECA Date</th>
                                            <th>Completed By (Staff)</th>
                                            <th>Areas of Need (Staff)</th>
                                            <th>Mental Health Referral Date</th>
                                            <th>Referral Based On</th>
                                        </tr>
                                    </thead>
                                    <tbody class="ersea-table-head bind_body scroll-tbody">



                                        <tr style="width:98.3%">
                                            <td style="padding: 25px;text-align:center;font-weight:bold;">Search by Center and Classroom<sup style="color:red;">*</sup></td>
                                        </tr>

                                    </tbody>



                                </table>


                                </div>
                            </div>




                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-----Div Cal Table-->




    <script>
        $(function () {
            var centerIdSelect = $('.center-select');
            var classRoomIdSelect = $('.select-classroom');
            var filterTypeSelect = $('.select-filter');
            var searchText = $('#searchText');



            //if ($('.scroll-tbody').children('.child-row').length <= 2) {
            //    $('.scroll-tbody').children('.child-row').each(function (i, row) {
            //        $(row).css({ 'width': '98.3%' });
            //    });
            //}
            //else if ($('.scroll-tbody').children('.child-row').length > 2) {
            //    $('.scroll-tbody').children('.child-row').each(function (i, row) {
            //        $(row).css({ 'width': '100%' });
            //    });
            //}

            $(window).bind("load resize", function () {

                topOffset = 50;
                width = (this.window.innerWidth > 0) ? this.window.innerWidth : this.screen.width;
                if (width < 768) {
                    topOffset = 100; // 2-row-menu
                }

                height = ((this.window.innerHeight > 0) ? this.window.innerHeight : this.screen.height) - 1;

                height = height - topOffset;
                if (height < 1) height = 1;
                if (height > topOffset) {
                    var fileHeight = height - 25;

                    $('.right-side-container-ch').css('min-height', (fileHeight - 5) + 'px');
                    $('.scroll-tbody').height(fileHeight - 317);
                }

                //reSizeContent();
            });



            function getListByFilter() {
               
                $('#spinner').show();
                $.ajax({
                    url: '/EducationManager/GetScreeningInfoDeca',
                    datatype: 'json',
                    type: 'post',
                    contentType: "application/json;",
                    data:JSON.stringify({ centerId: parseInt(centerIdSelect.val()), classRoomId: parseInt(classRoomIdSelect.val()), filterType: parseInt(filterTypeSelect.val()) }),
                    success: function (data) {
                        
                        var appendData = '';
                        var totalCount = 0;
                        var noRecordTmp = '<tr style="width:98.3%"><td style="padding: 25px;text-align:center;">Records Not Found</td></tr>';
                        if (data != null) {
                           
                            if (data.ScreeningAnalysisInfoList != null) {
                               
                                if (data.ScreeningAnalysisInfoList.length > 0) {

                                    totalCount = (data.ScreeningAnalysisInfoList.length > 0 && data.ScreeningAnalysisInfoList.length < 10) ? '0' + data.ScreeningAnalysisInfoList.length : data.ScreeningAnalysisInfoList.length;

                                    $.each(data.ScreeningAnalysisInfoList, function (i, info) {

                                       
                                        appendData += '<tr>\
                                                    <td data-title="Client" wrap>\
                                                        <p class="client-name" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.ChildName + '"  style="text-align:center;" accesskey=' + info.ClientId + '>' + info.ChildName + '</p>\
                                                    </td>\
                                                    <td data-title="Parent Name" wrap >\
                                                        <p class="parent-name" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.dob + '"  style="text-align:center;">' + info.dob + '</p>\
                                                    </td>\
                                                    <td data-title="Classroom" wrap>\
                                                      <p>  <a class="center-name" href="#" title="'+ info.CenterName + '" accesskey=' + info.CenterId + ' >' + info.CenterName + '</a></p>\
                                                    </td>\
                                                    <td data-title="Classroom" wrap>\
                                                       <p> <a class="classroom-name" href="#"  title="'+ info.ClassroomName + '" accesskey=' + info.ClassroomId + '>' + info.ClassroomName + '</a></p>\
                                                    </td>\
                                                    <td data-title="Classroom" wrap>\
                                                        <a class="email-id" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.InitialParentDecaDate + '"  style="text-align:center;">' + info.InitialParentDecaDate + '</a>\
                                                    </td>\
                                                     <td data-title="Classroom" wrap>\
                                                        <a class="email-id" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.FamilyCompleted + '"  style="text-align:center;">' + info.FamilyCompleted + '</a>\
                                                    </td>\
                                                    <td data-title="Classroom" wrap>\
                                                        <a class="email-id" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.Relationship + '"  style="text-align:center;">' + info.Relationship + '</a>\
                                                    </td>\
                                                    <td data-title="Classroom" wrap>\
                                                        <a class="email-id" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.AreaofNeed1 + '"  style="text-align:center;">' + info.AreaofNeed1 + '</a>\
                                                    </td>\
                                                     <td data-title="Classroom"  wrap>\
                                                        <a class="email-id" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.InitialStaffDecaDate + '"  style="text-align:center;">' + info.InitialStaffDecaDate + '</a>\
                                                    </td>\
                                                    <td data-title="Classroom" wrap>\
                                                        <a class="email-id" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.StaffCompleted + '"  style="text-align:center;">' + info.StaffCompleted + '</a>\
                                                    </td>\
                                                    <td data-title="Classroom" wrap>\
                                                        <a class="email-id" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.AreaofNeed2 + '"  style="text-align:center;">' + info.AreaofNeed2 + '</a>\
                                                    </td>\
                                                     <td data-title="Classroom" wrap>\
                                                        <a class="email-id" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.MentalHealthDate + '"  style="text-align:center;">' + info.MentalHealthDate + '</a>\
                                                    </td>\
                                                    <td data-title="Classroom" wrap>\
                                                        <a class="email-id" href="#" data-toggle="tooltip" data-placement="top"  title="' + info.ReferralBasedOn + '"  style="text-align:center;">' + info.ReferralBasedOn + '</a>\
                                                    </td>\
                                                     </tr>';

                                    });

                                    $('.scroll-tbody').html(appendData);


                                    if (document.documentMode || /Edge/.test(navigator.userAgent)) {

                                        if (data.ScreeningAnalysisInfoList.length <= 2) {
                                            //$('.scroll-tbody').children('.child-row').each(function (i, row) {
                                            //    $(row).css({ 'width': '98.3%' });
                                            //});
                                            $('.scroll-tbody').css({ 'width': '98.3%' });
                                        }
                                        else {
                                            //$('.scroll-tbody').children('.child-row').each(function (i, row) {
                                            //    $(row).css({ 'width': '100%' });
                                            //});
                                            $('.scroll-tbody').css({ 'width': '99.4%' });
                                        }

                                    }


                                    else if (data.ScreeningAnalysisInfoList.length <= 2) {
                                        //$('.scroll-tbody').children('.child-row').each(function (i, row) {
                                        //    $(row).css({ 'width': '98.3%' });
                                        //});
                                        $('.scroll-tbody').css({ 'width': '98.3%' });
                                    }
                                    else {
                                        //$('.scroll-tbody').children('.child-row').each(function (i, row) {
                                        //    $(row).css({ 'width': '100%' });
                                        //});
                                        $('.scroll-tbody').css({ 'width': '100%' });
                                    }
                                }
                                else {

                                    $('.scroll-tbody').html(noRecordTmp);

                                }

                            }
                            else {

                                $('.scroll-tbody').html(noRecordTmp);

                            }
                        }
                        else {

                            $('.scroll-tbody').html(noRecordTmp);

                        }
                        $('#totalCountSpan').text(totalCount);

                        $('#spinner').hide();
                    },
                    error: function (response) {
                        $('#spinner').hide();
                        console.log(response);
                        alert('error');

                    }

                })

            }

            $('.scroll-tbody').find('.phone-no-table').each(function (i, table) {
                $(table).find('td').each(function (j, td) {

                    var clas = $(td).attr('class');
                    var hgt = $(td).height();
                    $('.lbl_' + clas + '').height(hgt);
                });
            });

            $('.center-select').on('change', function () {

                var centerId = $(this).val();
                if (centerId == '0') {
                    $('.select-classroom').html('<option value="0">--Select Classroom--</option>');
                    $('.select-filter').val(0);
                    var searchRow = '<tr style="width:98.3%">\
                                            <td  style="padding: 25px;text-align:center;">Search by Center and Classroom<sup style="color:red;">*</sup></td>\
                                        </tr>';
                    $('.scroll-tbody').html(searchRow);
                }
                else {
                    $.ajax({
                        url: "/AgencyUser/GetClassByCenterID",
                        datatype: 'json',
                        type: 'post',
                        data: { CenterID: centerId },
                        success: function (data) {
                            if (data.length > 0) {
                                var classroom = '<option value="0">--Select Classroom--</option>';

                                if (data.length === 1) {
                                    classroom = '<option value=' + data[0].ClassRoomId + '>' + data[0].ClassRoomName + '</option>';
                                    $('.select-classroom').html(classroom);
                                }

                                else {
                                    $.each(data, function (i, element1) {
                                        classroom += '<option value=' + element1.ClassRoomId + '>' + element1.ClassRoomName + '</option>';
                                    });
                                    $('.select-classroom').html(classroom);
                                }
                                //if (data.length === 1) {
                                //    $('.select-classroom').val(data[0].ClassRoomId);
                                //}
                            }
                        },
                        error: function (data) {

                        }
                    });
                }
            });

            $('#searchByfilter').on('click', function () {

                cleanValidation();
                if ($('.center-select').val() === '0') {
                    plainValidation('#ddlCenterDetails');
                    customAlert('Please Select Center');
                    return false;
                }
              
                getListByFilter();

            });

            $('#searchByemailName').on('click', function () {

                getListByFilter();

            });

        });
    </script>




}
