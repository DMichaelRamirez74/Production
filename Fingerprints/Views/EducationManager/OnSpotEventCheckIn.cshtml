@{
    ViewBag.Title = "OnSpotEventCheckIn";
     Layout = "~/Views/Shared/AgencyStaffLayout.cshtml";
   // Layout = "~/Views/Shared/_EventCheckInLayout.cshtml";
}
@model FingerprintsModel.EventReportDetails

@section MainContentHolder{

    <style type="text/css">


         .fb_headscale .page-header {
            border-bottom: 4px solid #f9c751 !important;
            color: #fff;
        }
          .page-wrapper-change {
            background-image: url('../../Images/body-bg.jpg');
            background: url('../../Images/body-bg.jpg') center no-repeat #000 !important;
            background-size: cover !important;
            background-position: 100% 100% !important;
        }



        .eve-label {
            font-size: 15px;
        }

            .candidate-sign {
        background: #ddd;
        border-color: #fff;
         width: 100%;
         height: 100px;
    }
            .onspot-table{border: 1px solid #ddd;}
            .onspot-table thead tr{background: #9B58B4;}
            .onspot-table thead tr th{color:#fff;}

               .scroll-thead th {
           /* border: 1px solid #f1f5f8;*/
        }

        .scroll-thead {
            display: table;
            width: 100%;
            table-layout: fixed;
            width: 98.3%;
        }

        .scroll-tbody tr td{
            word-break: break-word;
        }

        .scroll-tbody {
            display: block;
            max-height: 400px;
            overflow: auto;
            overflow-x: hidden;
        }

            .scroll-tbody tr {
                display: table;
                width: 100%;
                table-layout: fixed;
            }
            .onspot-icons .fa-check{font-size: 20px;color: #5cb85c;margin-right: 10px;cursor:pointer;}
             .onspot-icons .fa-times{font-size:20px;color: #d9534f;cursor:pointer;}
            @@media (min-width: 992px) and (max-width: 1199px)
            {
                  /*Material-library*/
                  .table-th-width{width:100%!important;}
    /* Force table to not be like tables anymore */
    #no-more-tables6 table,
    #no-more-tables6 thead,
    #no-more-tables6 tbody,
    #no-more-tables6 th,
    #no-more-tables6 td,
    #no-more-tables6 tr {
        display: block;
        padding-left: 0;
        padding-right: 0;
    }

    /* Hide table headers (but not display: none;, for accessibility) */
    #no-more-tables6 thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
    }

    #no-more-tables6 tr {padding-top:10px;}

    #no-more-tables6 td {
        /* Behave  like a "row" */
        border: none;
        border-bottom: 1px solid #eee;
        position: relative;
        padding-left: 25%;
        white-space: normal;
        text-align:left;
    }

    #no-more-tables6 td:before {
        /* Now like a table header */
        position: absolute;
        /* Top/left values mimic padding */
        top: 6px;
        left: 6px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        text-align:left;
        font-weight: bold;
    }

    /*
    Label the data
    */
    #no-more-tables6 td:before { content: attr(data-title); }
            }


            @@media (min-width: 768px) and (max-width: 991px)
            {
                 .table-th-width{width:100%!important;}
            }
              @@media (min-width: 300px) and (max-width: 991px)
            {
                       /*Material-library*/

    /* Force table to not be like tables anymore */
    #no-more-tables6 table,
    #no-more-tables6 thead,
    #no-more-tables6 tbody,
    #no-more-tables6 th,
    #no-more-tables6 td,
    #no-more-tables6 tr {
        display: block;
        padding-left: 0;
        padding-right: 0;
    }

    /* Hide table headers (but not display: none;, for accessibility) */
    #no-more-tables6 thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
    }

    #no-more-tables6 tr {padding-top:10px;}

    #no-more-tables6 td {
        /* Behave  like a "row" */
        border: none;
        border-bottom: 1px solid #eee;
        position: relative;
        padding-left: 25%;
        white-space: normal;
        text-align:left;
    }

    #no-more-tables6 td:before {
        /* Now like a table header */
        position: absolute;
        /* Top/left values mimic padding */
        top: 6px;
        left: 6px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        text-align:left;
        font-weight: bold;
    }

    /*
    Label the data
    */
    #no-more-tables6 td:before { content: attr(data-title); }

            }

    </style>

    <div style="padding:30px 15px;margin:0;">

        <div class="container-fuild">
            <div class="row" style="margin:0px;">

                <div class="edu_class_room">
                    <div class="col-lg-12 fb_headscale">

                        <h2 class="page-header" style="margin-top:0px !important;">
                            <i class="fa fa-envelope" aria-hidden="true"></i>

                           Event Check-In

                        </h2>


                    </div>
                    <div class="row" style="color:#fff;">

                        <div class="col-md-12 mb10">
                        <div class="col-md-6">
                            <div class="col-md-12">
                                <label class="label eve-label">Event Name:</label>@Model.EventName
                            </div>

                            </div>
                        <div class="col-md-6">
                            <div class="col-md-12">
                                <label class="label eve-label"> Event Date:  </label> @Model.EventDate
                            </div>
                        </div>
                            </div>

                        <div class="col-md-12 mb10">

                            <div class="col-md-6">
                                <div class="col-md-12">
                                    <label class="label eve-label">Invited Staff:</label>@Model.ParticipantDetails.Count
                                </div>

                            </div>
                            <div class="col-md-6">
                                <div class="col-md-12">
                                    <label class="label eve-label">Participation:  </label> @Model.ParticipantCount
                                </div>
                            </div>
                            </div>
                        <div class="col-md-12 mb20">

                            <div class="col-md-6">
                                <div class="col-md-12">
                                    <label class="label eve-label">Trainer:</label>@Model.Trainer
                                </div>

                            </div>
                            </div>

                        </div>


                <div class="row">



    <div class="col-md-12">



         
        <div class="panel panel-default" style="border:none;">
            <div class="panel-heading" style="color:#fff;background:#009688">
                <h3 class="panel-title" style="width: 50%;display: inline-block;font-weight:bold;">Invites List</h3>

            </div>
            <div class="panel-body">


                <div class="mb10">
                    <div style="" class="col-sm-6 col-sm-offset-6 input-group date">
                        <input type="text" id="user-search" class="form-control" placeholder="Search by Name...">
                        <span class="input-group-addon searchByClientName search-group" style="background-color: #295b8f; color: #fff;">

                            <i class="glyphicon glyphicon-search" style=""></i><span class="searchName"> Search</span>
                        </span>
                    </div>
                </div>

                <div class="table-responsive" id="no-more-tables6">


                    <input type="hidden" name="EventId" value="@Model.Eventid" />


                    <table class="table onspot-table" id="checkin-table">

                        <thead class="scroll-thead">
                            <tr>
                                <th style="width:50px;" class="table-th-width"></th>
                                @*<th style="width: 140px;">Profile Picture</th>*@
                                <th>Name</th>


                                <th>Check-In Status</th>
                            </tr>
                        </thead>
                        <tbody class="text-center scroll-tbody"></tbody>
                    </table>

                    <script id="checkin-table" type="text/template">

                        <tr>

                            <td data-text=""></td>
                            @*<td data-text="">{{Profile-Picture}}</td>*@
                        </tr>

                    </script>


                                                    </div>


                                                </div>
                                            </div>


                                        </div>
                                    </div>

                                        </div></div></div></div>


                      

 



   


}



@section Script{

<link type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/themes/south-street/jquery-ui.css" rel="stylesheet">
<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.0/themes/south-street/jquery-ui.css" rel="stylesheet">

<script src="~/Scripts/jquery.touchsupport.js"></script>


    <script type="text/javascript">

        var eventCheckin = {
            absoluteUrl: "@Fingerprints.ViewModel.UrlExtensions.ToAvtarImages("samplestr")",
            init:function() {
                var self = this;
                self.initEvent();
                self.loadTable();
            },
            loadTable: function (options) {
                var self = this;
                options = options || {};
               
                $.ajax({
                    type: "POST",
                    url: HostedDir + "/EducationManager/GetUserListForEventChekin?eventid=@Model.Eventid",
                    data:JSON.stringify(options),
                    contentType: "application/json; charset=utf-8", 
                    success: function (data) {
                        console.log(data);
                        $("#checkin-table tbody").html('');

                        if (data && data.hasOwnProperty("ParticipantDetails") && data.ParticipantDetails.length) {

                            data.ParticipantDetails.forEach(function (obj,index) {
                                var srcStr = obj.Avatar ? self.absoluteUrl.replace("samplestr", obj.Avatar) : "@Url.Content("~/content/img/ic_male_default.png")";
                                var isAttand = obj.IsAttended == 1 ? '<span style="color:#3c883d;font-weight:bold;">Checked In</span>' : '<span style="color:red;font-weight:bold;">Not Checked In</span>';
                                var _name = obj.IsAttended == 1 ? obj.ParticipantName : '<a style="text-decoration:underline;z-index:999;position:relative;" href="' + HostedDir + '/EducationManager/StaffEventCheckin?userid=' + obj.ParticipantId + '&eventid=' + data.Eventid + '">' + obj.ParticipantName + '</a>';
                                var statusicon=  obj.IsAttended == 1 ? '<i class="fa fa-check"></i>' : '<i class="fa fa-times"></i>';
                                //var _imgStr = srcStr ? '<a class="view-pplink" data-index="'+index+'">view</a><img width="50" height="50" class="roundimage zoomify" src="' + srcStr + '" style="border-style:none;display:none;" alt="" />' : "";
                                var _str = "";
                                _str += '<tr>' +
                                    '<td style="width:50px;" data-title="Check-In" class="table-th-width"> <span class="onspot-icons">' + statusicon + '</span></td>' +
                      // '<td style="width: 140px;"></a><img width="50" height="50" class="roundimage" src="' + srcStr + '" style="border-style:none;" alt="" /></td>' +
                  '<td data-title="Staff Name">'+_name+'</td><td data-title="Status">' + isAttand + '</td></tr>';

                                $("#checkin-table tbody").append(_str);

                            });

                            $('img.zoomify').zoomify();
                        }

                    },
                    error: function (response) {
                        console.log(response);
                    },
                    complete: function (response) {
                        //console.log(response);
                    }
                })



            },
            initEvent:function(){
                var self = this;

                $('#menu-head').hide(); $('#side-menu').hide();
                $(".navbar-brand").prop('href', 'javascript:void(0)');

                $(document).on('keyup', "#user-search", function (e) {

                   

                    self.loadTable({ search: $(this).val() });
                })
               
                $(".candidate-sign").signature({ color: '#333' });

                $(document).on('click', '.sign-btn', function (e) {
                    e.preventDefault();
                    var _index = $(this).closest('tr').data('index');
                    console.log(_index);

                    $('tr[data-index="' + _index + '"]').after($("#signature-temp").html())
                    $(".sign-panel").slideDown();

                });

                $(document).on('click', '.accept-btn', function (e) {
                    e.preventDefault();
                    var _index = $(this).closest('tr').data('index');
                    var _sign = $('#sign_' + _index).signature('toJSON');

                    if (!JSON.parse(_sign).lines.length) {
                        customAlert("Signature is Required");
                        return false;
                    }

                    $('[name="Signature[' + _index + ']"]').val(_sign);
                    $(this).prop("disabled", true);

                    if (_sign != "") {
                        $("#sign_" + _index).signature('disable');
                        $("#sign_" + _index).signature('draw', JSON.parse(_sign));
                    }


                });

                $(document).on('click', '.clear-btn', function (e) {
                    var _index = $(this).closest('tr').data('index');

                    $('#sign_' + _index).signature('clear');
                    $('#sign_' + _index).signature('enable');
                    $('[data-index="' + _index + '"] td button.accept-btn').prop("disabled", false);

                });

                $(document).on('click', '#submit-data', function (e) {
                    e.preventDefault();
                    var inValidSign = [];
                    $(".candidate-sign").each(function (ele, ind) {
                        var _index = $(this).closest('tr').data('index');
                        var _signStr = $('[name="Signature[' + _index + ']"]').val(); //value of signature input
                        var _sign = $('#sign_' + _index).signature('toJSON');  // value of sign div
                        if (JSON.parse(_sign).lines.length && !_signStr) {
                            inValidSign.push($(".nameclmn_" + _index).text());
                        }
                    });

                    if (inValidSign.length) {
                        customAlert("Please Accept Signature of " + inValidSign.join(","));
                        return false;
                    }
                    $("#onpostform").submit();
                });

                $(".candidate-sign").each(function (ele, ind) {

                    var _index = $(this).closest('tr').data('index');
                    var _signStr = $('[name="Signature[' + _index + ']"]').val();

                    if (_signStr != "") {
                        $("#sign_" + _index).signature('disable');
                        $("#sign_" + _index).signature('draw', JSON.parse(_signStr));
                    }




                });

            },

        };

        // (function( $, window, undefined ) {
        $(document).ready(function () {
            eventCheckin.init();
        })
         //   })( jQuery, window );
    </script>

}
